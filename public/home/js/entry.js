document.domain="58.com";var GETSTATUS="http://im.58.com/common/common/are_users_online";
(function(){window.JSON||(window.JSON={parse:function(e){return eval("("+e+")")},stringify:function(){var e=Object.prototype.toString,d=Array.isArray||function(b){return"[object Array]"===e.call(b)},f={'"':'\\"',"\\":"\\\\","\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","\t":"\\t"},b=function(b){return f[b]||"\\u"+(b.charCodeAt(0)+65536).toString(16).substr(1)},k=/[\\"\u0000-\u001F\u2028\u2029]/g;return function h(a){if(null==a)return"null";if("number"===typeof a)return isFinite(a)?a.toString():"null";
if("boolean"===typeof a)return a.toString();if("object"===typeof a){if("function"===typeof a.toJSON)return h(a.toJSON());if(d(a)){for(var g="[",c=0;c<a.length;c++)g+=(c?", ":"")+h(a[c]);return g+"]"}if("[object Object]"===e.call(a)){g=[];for(c in a)a.hasOwnProperty(c)&&g.push(h(c)+": "+h(a[c]));return"{"+g.join(", ")+"}"}}return'"'+a.toString().replace(k,b)+'"'}}()})})();
(function(e){var d=e.$,f={},b=null,k=null,l=!1,h={NORMAL:{height:460,width:630},MIN:{height:45,width:205}};f.init=function(){this.initOnlineStatus(function(){e.webimconfig&&e.webimconfig.onBtnInited&&e.webimconfig.onBtnInited()})};f.createIframe=function(){b=document.createElement("IFRAME");b.style.position="fixed";b.style.right=0;b.style.bottom="-100%";b.style.zIndex=9999;b.src="//webim.58.com/index?p\x3drb";b.id="webimIframe";b.frameBorder=0;b.scrolling="no";b.width=0;b.height=0;b.name="webim";
document.body.appendChild(b)};f.initOnlineStatus=function(a){var b=this,c=[];d(".im-chat").each(function(a,d){(a=b.getData(d))&&c.push(a.userid)});if(0===c.length)a&&a();else{var e=function(c){d(".im-chat").each(function(a,e){if(a=b.getData(e))d(e).removeClass("im-online").removeClass("im-offline"),d(e).addClass(c[a.userid.toString()]?"im-online":"im-offline")})};d.ajax({url:GETSTATUS,type:"get",dataType:"jsonp",data:{userid:123,targetids:c.join(",")},success:function(c){var b={};0==c.error_code&&
d(c.data.results).each(function(c,a){b[a.id.toString()]="1"==a.is_online});e(b);a&&a()},fail:function(c){e({});a&&a()}})}};f.initClick=function(){var a=this,g=function(){var c=a.getData(d(this));c&&(l?b.contentWindow.chatTo(c):e.CL.invoke("popuplogin",{source:"webim",callback:function(){var a=setInterval(function(){l&&(clearInterval(a),b.contentWindow.chatTo(c))},200)}}))};if(d(document).on)d(document).on("click",".im-chat",g);else d(document).delegate&&d(document).delegate(".im-chat","click",g);
g=function(c){var a=document.getElementById("bindContent");if(!a||!d.contains(a,c.target)){var b=!1;d(".im-chat").each(function(a,e){if(e===c.target||d.contains(e,c.target))return b=!0,!1});b||k&&k.minimize()}};if(d("body").on)d("body").on("click",g);else d("body").delegate&&d("body").delegate(null,"click",g)};f.getData=function(a){var b=null;try{var c=d(a).attr("data-im"),c=decodeURIComponent(c),b=JSON.parse(c)}catch(m){console.error("data-im\u5b57\u7b26\u4e32\u975e\u6cd5")}return b};f.onAppBegin=
function(){l=!1};f.onAppCreated=function(a){b.style.bottom=0;k=a;var d=function(a){a=h[a];b.width=a.width;b.height=a.height};a.addEventListener("appstatusChanged",function(a){"NORMAL"!=a&&"MIN"!=a&&(a="NORMAL");d(a)});a.addEventListener("fullscreenChanged",function(){var a,d;return function(c){c?(a=b.width,d=b.height,b.width="100%",b.height="100%"):(b.width=a,b.height=d)}}());a.addEventListener("windowFocus",function(){e.focus()});a.minimize();d("MIN");l=!0};d(function(){var a=e.$;a("\x3cscript\x3e").attr("src",
"//j1.58cdn.com.cn/componentsLoader/dist/ComponentsLoader.js").appendTo(a("body"));(function(a){var b=document.createElement("link");b.type="text/css";b.rel="stylesheet";b.href=a;document.getElementsByTagName("head")[0].appendChild(b)})("//c.58cdn.com.cn/componentsLoader/dist/CompontsLoader.css");f.createIframe();f.initClick();f.initOnlineStatus(function(){e.webimconfig&&e.webimconfig.onBtnInited&&e.webimconfig.onBtnInited()})});e.WebIM=f})(window);