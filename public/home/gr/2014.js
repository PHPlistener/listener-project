OO(["com.mi.utils.time","com.mi.utils.Cookie","com.mi.widgets.sms","com.mi.passport.mibao","com.mi.utils.L11N","com.mi.utils.URL","com.mi.utils.Tip"],"com.mi.passport.portal.2014",function(u,n,j,z,s,k,A,l){window._tickRequests=[];function d(G,I){I=I||"0";var H=(+new Date)+"";var F="/pass/ajax/tick?_t="+H+"&biz="+G+"&step="+I;var D=_tickRequests.length;var E=_tickRequests[D]=new Image;E.onload=E.onerror=function(){E=_tickRequests[D]=null};E.src=F}function y(){location.reload(true)}function v(){location.reload(true)}function C(){var D=n.get("userId");if(D&&!isNaN(D)){if(D!==$(".na-num").text()){v();return false}return true}else{y();return false}}var b="";function m(D){b=D;location.hash=D}function f(D){if(D==="+86"){return"^1\\d{10}$"}else{return"^\\+?\\d{6,}$"}}function p(G,E,H,D){var K=".mod_tip_bd"||".bd";if(!H){H=""}else{H=""+H}var G=$(G);if(G.hasClass("quota_tip")){return}var J=MSG[E]||E;var I=G.parent().parent().next();if(J){if(H){var F=H.charAt(0);if(F==="5"){I.find("span").html(J+"("+H+")")}else{I.find("span").html(J)}}else{I.find("span").html(J)}if(!D){G.parent().addClass("error_bg")}I.removeClass("txt_tip");I.show()}else{if(H){I.find("span").html(H);if(!D){G.parent().addClass("error_bg")}I.show()}else{G.parent().removeClass("error_bg");if(G.data("error")===".error-password"){G.closest("dd").find(".labelbox").removeClass("error_bg");I.addClass("txt_tip");I.find("span").html(G.data("origin"))}I.hide()}}}function B(E){var F=E.attr("name");var D=E.val();if(D===""){p(E,F+"_empty")}else{if(!e(F,D,E)){console.log(F+"_rule");p(E,F+"_rule")}}}function e(F,H,D){var E=D.closest(".mod_tip_bd").find(".tits em").text();if(F==="phone"){var G=f(E);return RegExp(G).test(H)}else{if(F==="icode"){return/^\w{4,8}$/.test(H)}else{if(F==="email"){return/^[\w.\-]+@(?:[A-Za-z0-9]+(?:-[A-Za-z0-9]+)*\.)+[A-Za-z]{2,6}$/.test(H)}else{if(F==="ticket"){return/^\d{4,8}$/.test(H)}else{if(F==="repassword"){return !(H.length<8||H.length>16||/^\d+$/.test(H)||/^[A-Za-z]+$/.test(H)||/^[^A-Za-z0-9]+$/.test(H))}else{if(F==="repassword2"){return H===$($(D).data("repeat")).filter("[name]").val()}}}}}}return true}function o(F){var D=$(F).find("input[name]");var E;$(D).each(function(){E=0;var H=$(this);var I=H.attr("name");var G=H.val();if(!H.is(":hidden")){if(G===""){p(H,I+"_empty");E++;return false}else{if(!e(I,G,H)){p(H,I+"_rule");E++;return false}else{if(I==="repassword"){if(G===$(H.data("repeat")).filter("[name]").val()){p(H,I+"_rule2");E++;return false}}}}}});return E?false:true}$.parseJSONSafe=function(D){try{return $.parseJSON(D)}catch(E){return{code:5000000,result:5000000,description:"Not JSON"}}};$.fn.showError=function(D){if(!D){D=""}else{D=""+D}return this.each(function(F,H){var E=$(H);if(E.hasClass("quota_tip")){return}var I=E.attr("_text");if(I&&D){var G=D.charAt(0);if(G==="5"){E.text(I+"("+D+")").show()}else{E.text(I).show()}}else{if(D&&!I){E.text(D).show()}else{E.text(I).show()}}})};$.fn.hideError=function(){return this.each(function(E,F){var D=$(F);if(D.hasClass("quota_tip")){return}var G=D.attr("_text");if(G){D.text(G).hide()}else{D.hide()}})};$.fn.showPopup=function(){this.each(function(F,G){var E=$(G),D=E.closest(".popup_mask");if(D.length){D.show()}E.show();switch(G.id){case"popManageTokenStatus":case"popManageTokenKeys":E.positionPopup();default:}switch(G.id){case"popManageTokenStatus":case"popManageTokenHome":m("#service=setToken");break;case"popSwitchRegion":m("#service=switchRegion");break;case"popUpdatePassword":m("#service=setPassword");break;case"popEnterNewEmail":m("#service=bindEmail");break;case"popEnterNewPhone":m("#service=bindPhone");break;case"popSetMibao":case"popAnswerMibao":case"popFinishMibao":m("#service=setMibao");break;case"popSuicideWarning":m("#service=suicide");break;default:}});if($(".popup_mask:visible").length){$(document.body).css({"overflow-y":"hidden"})}else{}return this};$.fn.hidePopup=function(D){D=D||{};this.each(function(G,H){var F=$(H),E=F.closest(".popup_mask");if(E.length){E.hide()}F.hide();if(!D.dontAffectHash){switch(H.id){case"popUpdatePassword":case"popEnterNewEmail":case"popEnterNewPhone":case"popSetMibao":case"popAnswerMibao":case"popFinishMibao":case"popManageTokenStatus":case"popManageTokenHome":case"popSuicideWarning":case"popSuicidePrompt":case"popSuicideSuccess":case"popSuicideFailure":case"popSwitchRegion":if(location.hash){m("#")}break;default:}}});if($(".popup_mask:visible").length){$(document.body).css({"overflow-y":"hidden"})}return this};$.fn.positionPopup=function(){return this.each(function(F,G){var E=$(G);var D=$(window).height();var H=G.offsetHeight;if(H>D){E.css("top","0")}else{E.css("top",Math.round((D-H)/2)+"px")}})};$.fn.radioTab=function(){var L=new Date();var K=L.getFullYear();var J=L.getMonth()+1;var G=L.getDate();var M=function(W){W.__initedTab=true;var T=$(W);var N=T.find(".md_list_con");var U=T.find(".retrieve-type-year");var S=T.find(".retrieve-type-month");var O=T.find(".retrieve-type-date");var V="";var P="";var R={};R[28]="";for(var Q=K;Q>2010;Q--){V+="<p data-value='"+Q+"'>"+Q+"</p>"}$.each(["01","02","03","04","05","06","07","08","09","10","11","12"],function(X,Y){P+="<p data-value='"+Y+"'>"+Y+"</p>"});$.each(["13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28"],function(X,Y){R[28]+="<p data-value='"+Y+"'>"+Y+"</p>"});R[28]=P+R[28];R[29]=R[28]+"<p data-value='29'>29</p>";R[30]=R[29]+"<p data-value='30'>30</p>";R[31]=R[30]+"<p data-value='31'>31</p>";U.html(V);S.html(P);T.find(".date-select").each(function(Y,Z){var aa=$(Z).find(".date-select-val");var X=$(Z).find(".date-select-options");aa.click(function(){X.toggle();return false});aa.find(".timecon").data("value","");X.delegate("p","click",function(ad){var ac=$(this).data("value");var ab=aa.find(".timecon");if(!ab.data("origin")){ab.data("origin",ab.text())}ab.data("value",ac).text(ac);X.hide();E();I(O,R);return false})});T.find("textarea").bind("input change propertychange",function(){E()})};var H=this;var I=function(R,U){var X=H.filter(".now");var O=X.find(".md_list_con");var Z=O.data("type");var T=O.find(".date-select-val .timecon");var aa=parseInt($(T[0]).data("value"));var P=parseInt($(T[1]).data("value"));var W=parseInt($(T[2]).data("value"));if(T.length===3){var ab=parseInt($(T[0]).data("value"));var Q=parseInt($(T[1]).data("value"));var Y=parseInt($(T[2]).data("value"));if(ab&&Q){var V=new Date(new Date(ab,Q)-1).getDate();R.html(U[V]);if(Y&&Y>V){var ac=$(T[2]).data("origin");ac&&$(T[2]).text(ac)}}else{var ac=$(T[2]).data("origin");ac&&$(T[2]).text(ac)}}var S=$(O.find(".retrieve-type-month")).find("p");var N=$(O.find(".retrieve-type-date")).find("p");if(aa&&aa===K){$(S).each(function(ad,af){var ae=parseInt($(af).data("value"));if(ae<=J){$(af).show()}else{$(af).hide()}});$(N).each(function(ad,af){var ae=parseInt($(af).data("value"));if(ae<=G){$(af).show()}else{$(af).hide()}});if(P>J){var ac=$(T[1]).data("origin");ac&&$(T[1]).text(ac)}if(W&&W>G){var ac=$(T[2]).data("origin");ac&&$(T[2]).text(ac)}}else{$(S).show()}};var F=function(){var R=H.filter(".now");var N=R.find(".md_list_con");var Q=N.data("type");var S=R.data("type");var P="";if(Q==="date"){var O=N.find(".date-select-val .timecon");P=""+$(O[0]).data("value")+"-"+$(O[1]).data("value")+(O[2]?("-"+$(O[2]).data("value")):"");if(S===3){if(P.split("-").join("").length<8){return false}}else{if(P.split("-").join("").length<6){return false}}}else{P=N.find("textarea").val()+"";if(P.length<10){return false}}return{retrieveType:S,retrieveTypeValue:P}};var D="";var E=function(){var N=F();if(N!==D){D=N;H.filter(".now").trigger("radioTabValueChange",N)}};this.each(function(N,O){$(O).click(function(){H.removeClass("now");$(this).addClass("now");$(this).find(".date-select-options").hide();!this.__initedTab&&M(this);E()})});$(this.get(0)).trigger("click");return this};$(function(){$(".err_tip, .txt_tip").each(function(E,F){var D=$(F);D.attr("_text",D.text())})});function t(D){if(D){if(D.code&&D.code!=3001){var E=$("#popVeriFailed");E.find(".err_code").text(D.code);E.showPopup()}}}var h=l.$class({constructor:function(){this.$passwordMgr=$("[_role=passwordMgr]");this.$emailMgr=$("[_role=emailMgr]");this.$phoneMgr=$("[_role=phoneMgr]");this.$mibaoMgr=$("[_role=mibaoMgr]");this.$tokenMgr=$("[_role=tokenMgr]")},syncHash:function(){var E=k.parse(location.hash);var F=location.hash;if(F===b){return}var D=E.service||"";b=F;switch(D){case"bindPhone":d("changePhone");$("#btnUpdatePhone").click();break;case"bindEmail":d("changeEmail");$("#btnUpdateEmail").click();break;case"setMibao":$("#btnSetMibao").click();break;case"setPassword":d("changePassword");$("#btnUpdatePassword").click();break;case"setToken":d("enableTwoStepLogin");$("#btnManageToken").click();break;case"suicide":d("delAccount");this.suicide();break;default:$("#popUpdatePassword, #popEnterNewEmail, #popEnterNewPhone, #popSetMibao, #popAnswerMibao, #popFinishMibao, #popManageTokenStatus, #popSuicideWarning, #popManageTokenHome, #popManageTokenStatus").hidePopup()}},render:function(){this.uiBind();this.syncHash();setInterval(l.proxy(function(){this.syncHash()},this),500)},phoneImageBlurTimer:null,emailImageBlurTimer:null,showPhonePanel:function(){var J=$("#phonePanel");var I=$(".phone-panel-main").show();var H=$(".phone-panel-del").hide();var D=$(".phone-panel-del-success").hide();var E=J.find(".phone_panel_list_con");var F=J.find(".btn_mod_close");J.showPopup();if(!J.data("panel-inited")){J.data("panel-inited",true);E.delegate(".phone_panel_list_el","click",function(K){K.stopPropagation();E.find(".phone_panel_list_el").removeClass("now");$(this).addClass("now")});I.find("a[data-action]").bind("click",l.proxy(function(P){P.stopPropagation();var O=$(P.target).data("action");var N=E.find(".now .phone-panel-number");var L=N.data("phone");var M=N.data("key");if(!L||!M){return}if(O==="update"){d("changePhone");MiAccountVerification({url:"/pass/auth/security/bindSafeAddress?type=PH&userId="+$(".na-num").text(),user:$(".na-num").text(),deviceType:JSP_VAR.deviceType,success:l.proxy(function(S){this.enterNewPhone(S)},this,{action:O,phone:L,key:M}),fail:function(S){t(S)},beforeModal:function(){J.hidePopup({dontAffectHash:true})}})}else{I.hide();H.show();H.find(".err_tip").hide();H.find("input[name=delphone]").val("");H.find("input[name=delphone]").parent().removeClass("error_bg");var R=H.find(".phone-panel-del-title");var Q=$(".del-ph-num");R.html(R.data("title-tpl").replace("{phone}",L));Q.html(L);var K=L.split(/\*+/);if(K.length===2){H.find(".phone-blank-prefix").text(K[0]+"");H.find(".phone-blank-suffix").text(K[1]+"")}}return false},this));H.find("input[name=delphone]").bind("focus",function(){H.find(".err_tip").hide()});H.find("a[data-action]").bind("click",l.proxy(function(M){M.stopPropagation();var L=$(M.target).data("action");if(L==="cancel"){H.hide();I.show();return}var K=[$.trim(H.find(".phone-blank-prefix").text()),$.trim(H.find("input[name=delphone]").val()),$.trim(H.find(".phone-blank-suffix").text())].join("");var N=H.find(".err_tip");$.ajax({type:"post",url:"/pass/auth/security/deletePhone",dataType:"text",data:{passport_ph:n.get("passport_ph")||"",usercenter_ph:n.get("usercenter_ph")||"",userId:$(".na-num").text(),phone:K},success:function(P){P=P.replace("&&&START&&&","");P=$.parseJSONSafe(P);var O=+P.result;if(O===0){H.hide();D.show()}else{if(O===1200254||O===1200255){N.show().find(".del-error").html(s.getResource("jsp_ph_delete_error"))}else{if(O===5200253||O===5200257){N.show().find(".del-error").html(s.getResource("jsp_error")+O)}}}},fail:function(){N.show().find(".del-error").html(s.getResource("jsp_error"))},error:function(){N.show().find(".del-error").html(s.getResource("jsp_error"))}})},this));D.find("a[data-action]").bind("click",function(K){K.stopPropagation();D.hide();location.reload()});F.bind("click",function(K){K.stopPropagation();location.reload()})}var G=[];$.each(userPhoneList,function(K,L){G.push("<li class='phone_panel_list_el'>  <i class='acctip_icon acctip_icon_8'></i>  <span data-phone='"+L.address+"' class='phone-panel-number' data-key='"+L.key+"'>"+L.address+"</span></li>")});E.html(G.join(""))},suicide:function(){var D=$("#popSuicideWarning");D.find(".twostep_trustinfo").removeClass("now");D.find(".err_tip").hideError();D.showPopup();$.ajax({type:"GET",url:"/pass/auth/security/getAccountStatus",data:{userId:$(".na-num").text()},dataType:"text",success:function(H){H=H.replace("&&&START&&&","");H=$.parseJSONSafe(H);var F=+H.result;if(F===0){var E=+H.info.leftTimes;if(E<=1){D.find(".warn-text").show()}}else{if(F===5200600){var G=H.info&&H.info.sids;$.each((G||[]),function(I,J){D.find(".del-account-deny-"+(J+"").split(".").join("")).show()});D.find(".del-account-allow").hide();D.find(".del-account-deny").show();D.find(".del-account-deny .btn_back").css({border:"1px solid #ff6f3d",color:"#FFF",background:"#ff6f3d"})}else{D.find(".sys_err").showError(F)}}}})},uiBind:function(){$("#popSuicideWarning .twostep_trustinfo").click(function(W){var X=$("#popSuicideWarning");var Y=$(W.currentTarget);Y.toggleClass("now");if(X.find(".sys_err:visible").length){X.find(".btn_commom").addClass("disabled")}else{if(Y.hasClass("now")){X.find(".btn_commom").removeClass("disabled")}else{X.find(".btn_commom").addClass("disabled")}}});$("#popSuicideWarning .btn_commom").click(l.proxy(function(Z){Z.preventDefault();var ab=$(Z.currentTarget);var aa=$("#popSuicidePrompt");if(ab.hasClass("disabled")){return}$("#popSuicideWarning").hidePopup({dontAffectHash:true});var Y=false;var X="";var W="";MiAccountVerification({url:"/pass/auth/security/del?userId="+$(".na-num").text(),user:$(".na-num").text(),deviceType:JSP_VAR.deviceType,success:l.proxy(function(){Y=true;$.ajax({type:"GET",url:"/pass/auth/security/getAllLoginDevices",data:{userId:$(".na-num").text()},dataType:"text",success:function(ae){ae=ae.replace("&&&START&&&","");ae=$.parseJSONSafe(ae);var ac=+ae.result;if(ac===0){X=ae.info.device;if(X.length){$(".del-devices-panel").show();for(var ad=0;ad<X.length;ad++){W+="<li>"+X[ad]+"</li>"}$(".online-devices").append(W)}}else{aa.find(".sys_err").showError(ac)}$("#popSuicideWarning").hidePopup({dontAffectHash:true});$("#popSuicidePrompt").showPopup()}})},this),fail:function(ac){if(Y){return}$("#popSuicideWarning").showPopup();t(ac)}})},this));$("#popSuicidePrompt .btn_commom").click(function(W){W.preventDefault();var X=$("#popSuicidePrompt");$.ajax({type:"POST",url:"/pass/auth/security/del",data:{passport_ph:n.get("passport_ph")||"",usercenter_ph:n.get("usercenter_ph")||"",passportsecurity_ph:n.get("passportsecurity_ph")||"",passToken:n.get("passToken")||"",userId:$(".na-num").text()},dataType:"text",success:function(Z){Z=Z.replace("&&&START&&&","");Z=$.parseJSONSafe(Z);var Y=+Z.result;if(Y===0){$("#popSuicidePrompt").hidePopup({dontAffectHash:true});$("#popSuicideSuccess").showPopup();var aa=new u.Countdown({duration:10000,onProgress:function(ab){$("#popSuicideSuccess .wapbox p span").text(Math.round(ab.timeLeft/1000))},onComplete:function(){location.href="/"}});aa.start()}else{switch(Y){case 1200603:X.find(".del_fail").showError(Y);case 5200604:case 5200605:case 5200606:case 5200607:X.find(".sys_err").showError(Y);default:}}}})});$("#popSuicideWarning .btn_back, #popSuicidePrompt .btn_back, #popSuicideSuccess .btn_back, #popSuicideFailure .btn_back").click(function(W){W.preventDefault();$(W.target).closest(".mod_acc_tip").hidePopup()});$(document.body).delegate(".mod_acc_tip .btn_mod_close, .mod_acc_tip .btn_close_popup","click",function(W){W.preventDefault();var X=$(W.target).closest(".mod_acc_tip"),Y=X.attr("id");switch(Y){case"popManageTokenSetMobile":$("#popManageTokenStatus").showPopup().find(".err_tip").hide();X.hidePopup();break;case"popManageTokenKeys":$("#popManageTokenStatus").showPopup().find(".err_tip").hide();X.hidePopup();break;case"popManageTokenDisableFinish":location.href="/";break;case"popManageTokenFinish":location.href="/";break;case"popEnterNewPhone":if(X.find("dl.success:visible").length){location.href="/"}else{X.hidePopup()}break;case"popEnterNewEmail":if(X.find("dl.success:visible").length){location.href="/"}else{X.hidePopup()}break;case"popSetMibao":location.href="/";break;default:X.hidePopup()}});$("#popManageTokenTrustDevice .token_chk_area").click(function(Y,X){Y.preventDefault();var W=$("#popManageTokenTrustDevice .icon_token_chk");if(JSP_VAR.deviceType==="mobile"){if(W.closest("#popManageTokenTrustDevice").length){Y.stopPropagation()}}if(W.hasClass("icon_false")){W.removeClass("icon_false").addClass("icon_true")}else{W.removeClass("icon_true").addClass("icon_false")}});$(".click-row .font-img-item").click(function(X){X.preventDefault();X.stopPropagation();if(JSP_VAR.deviceType!=="mobile"){return}var W=$(X.currentTarget).parent().find(".ada-btn-area");var Y=W.children().length;if(Y>1){W.toggle()}else{W.click()}});$("#btnUpdatePassword").click(l.proxy(function(W){W.stopPropagation();W.preventDefault();if(!C()){return}d("changePassword");MiAccountVerification({url:"/pass/auth/security/changePassword?userId="+$(".na-num").text(),user:$(".na-num").text(),deviceType:JSP_VAR.deviceType,success:l.proxy(function(){this.resetUpdatePasswordForm();this.editPassword()},this),fail:function(X){t(X)}})},this));$("#popUpdatePassword .oldPass").on("focus click",l.proxy(function(W){$("#popUpdatePassword .grpOldPass .err_tip").hideError();$("#popUpdatePassword .grpOldPass label").removeClass("error_bg")},this)).blur(l.proxy(function(W){this.checkOldPassword()},this));var P,N;$("#popUpdatePassword .newPass, #popUpdatePassword .newPass2").on("focus click",l.proxy(function(W){W.stopImmediatePropagation();$("#popUpdatePassword .grpNewPass .err_tip").hideError();$("#popUpdatePassword .grpNewPass .txt_tip").show();$("#popUpdatePassword .grpNewPass label").removeClass("error_bg");clearTimeout(P);clearTimeout(N)},this)).blur(l.proxy(function(X){var Y;var W=$(X.target);if(W.hasClass("newPass")){P=setTimeout(l.proxy(function(){this.checkNewPasswords(X)},this),300)}else{if(W.hasClass("newPass2")){N=setTimeout(l.proxy(function(){this.checkNewPasswords(X)},this),300)}}},this));var O=false;$("#popUpdatePassword .chkcode_img, #popUpdatePassword .next_capt").click(l.proxy(function(W){W.preventDefault();this.nextUpdatePasswordCaptcha()},this)).mouseover(l.proxy(function(W){O=true},this)).mouseout(l.proxy(function(W){O=false},this));var Q=l.proxy(function(X){X.stopImmediatePropagation();var W=X.target;$(W.parentNode).removeClass("error_bg");$("#popUpdatePassword .capt_box .err_tip").hideError()},this);$("#popUpdatePassword .chkcode input").on("focus click",Q).blur(l.proxy(function(W){if(O){return}this.checkPasswordCaptcha()},this));$("#popUpdatePassword .btnCancel").click(l.proxy(function(W){W.preventDefault();$("#popUpdatePassword").hidePopup()},this));$("#popUpdatePassword .btnOK").click(l.proxy(function(W){W.preventDefault();$("#popUpdatePassword .err_tip").hideError();$("#popUpdatePassword .error_bg").removeClass("error_bg");this.onUpdatePassword(W)},this));if(userPhoneList.length){$(".btnBindMobile").text(s.getResource("jsp_add"))}if(userPhoneList.length>1){var S=$(".phone-list-sum");if(S.length>0&&S.data("title")){S.html(S.data("title").replace("{phsum}",userPhoneList.length))}S.show()}$("#btnUpdatePhone").click(l.proxy(function(Z){Z.stopPropagation();Z.preventDefault();if(!C()){return}var Y=Z.target;var X="add";var W=userPhoneList[0]||{};if($(Y).data("mode")==="update"){X="update";if(userPhoneList.length>1){this.showPhonePanel();return}}d("changePhone");MiAccountVerification({url:"/pass/auth/security/bindSafeAddress?type=PH&userId="+$(".na-num").text(),user:$(".na-num").text(),deviceType:JSP_VAR.deviceType,success:l.proxy(function(aa){this.enterNewPhone(aa)},this,{action:X,phone:W.address,key:W.key}),fail:function(aa){t(aa)}})},this));$("#popEnterNewPhone .new_capt").click(l.proxy(this.reloadUpdatePhoneCaptcha,this));$("#popEnterNewPhone .chkcode_img").click(l.proxy(this.reloadUpdatePhoneCaptcha,this));var K=$("input[name]");K.bind("focus",function(){p($(this))});K.bind("blur",function(){B($(this))});$("#popEnterNewPhone .binding .btn_commom").click(l.proxy(this.onEnterNewPhone,this));var F=$(".bind-info-panel");var H=$("#popEnterNewPhone .binding");F.delegate("a[data-action]","click",l.proxy(function(Y){Y.stopPropagation();var X=$(Y.target).data("action");var W=$(Y.target).data("type");if(X==="ok"){this.checkNewPhone()}else{if(X==="back"){F.hide();H.show()}}},this));$("#popEnterNewPhone .binding .set_qst_tit").click(function(W){$("#popEnterNewPhone .binding .country-container").toggle();W.stopPropagation();W.preventDefault()});$(".country-container-panel").each(function(X,Y){var W=$("<div>").addClass("country-container");W.html(RegionsCode.getAll({usual:"常用"},true));$(Y).append(W)});$(".country-container-panel .country-container").delegate(".record","click",function(ab){var W=$(ab.target),aa=W.closest(".binding").find(".set_qst_tit"),ac=aa.find("span"),X=aa.find("em");var Z=W.closest(".record");var Y=Z.find(".record-country");ac.text(Y.text());X.text(Y.data("code"));X.attr("_code",Y.data("code"));W.closest(".country-container").hide();ab.preventDefault()});$(document.body).click(function(W){$(".country-container").hide()});$(".country-container-panel .btn-cancel").bind("click",function(W){W.stopPropagation();$(this).closest(".country-container").hide()});$(".country-container-panel .country-container").bind("click",function(W){W.stopPropagation()});$("#popEnterNewPhone .verify .btn_commom").click(l.proxy(this.onVerifyNewPhone,this));$("#popEnterNewPhone .verify .btn_back, #popEnterNewPhone .btn_mod_close").click(l.proxy(this.cancelUpdatePhone,this));$("#popEnterNewPhone .success .btn_commom").click(function(W){location.href="/"});var R=null;$("#popEnterNewPhone .verify .resend").click(function(){clearTimeout(R)});var L=j.Sender;if(this.updatePhoneSMSSender){this.updatePhoneSMSSender.stop()}var G=this.updatePhoneSMSSender=new L({smsFailureMsgBox:".sms_custom",maxQuotaToShow:2,timeStep:60*1000,type:150007,onResend:false,userBox:$('<input type="text">').val($(".na-num").text()),phoneBox:"#popEnterNewPhone .binding .full_new_phone",icodeCallback:function(Y,ac){var ab=s.getResource("jsp_regst_img_code_incorrect");var Z=$("#popEnterNewPhone");var aa=Z.find(".binding");var X=Z.find(".bind-info-panel");var W=Z.find(".verify");aa.find(".chkcode_img").click();aa.find(".capt_box").val("");if(!this.onResend){X.hide();aa.show();console.log(this.onResend+":all")}if(Y===0){$(Z.find(".tab_opt span").removeClass("now")[1]).addClass("now");$(Z.find(".tabline i").removeClass("now")[1]).addClass("now");aa.hide();W.show()}else{if(Y===1200201){p(aa.find(".capt_box"),"icode_rule")}else{if(Y===1200258){p(aa.find(".new_phone"),"phone_rule")}else{if(Y===1200237){p(aa.find(".new_phone"),"phoneUnqualCurrent")}else{if(Y===1200260){p(aa.find(".new_phone"),"phBindToOther")}else{if(Y===1200235){p(aa.find(".new_phone"),"reachMax")}else{if(Y===1200236){p(aa.find(".capt_box"),"bad_param",Y,true)}else{if(Y===1200263){W.hide();aa.show();p(aa.find(".capt_box"),"icode_rule")}else{if(Y===1200264){p($captchaPanel.find(".capt_box"),"icode_rule")}else{p(aa.find(".capt_box"),"error_system",Y,true)}}}}}}}}}},getCaptchaPostData:function(X){var W=$("#popEnterNewPhone .new_phone").val();var Z=$("#popEnterNewPhone .set_qst_tit em").attr("_code")||"";var aa=$("#popEnterNewPhone .binding .capt_box").val();if(Z==="+86"){Z=""}W=Z+W;var Y={userId:$(".na-num").text(),passport_ph:n.get("passport_ph")||"",usercenter_ph:n.get("usercenter_ph")||"",passportsecurity_ph:n.get("passportsecurity_ph")||"",passToken:n.get("passToken")||"",phone:W};return Y},phoneTipLabel:"",duplicatePhoneHTML:"",sendButton:"#popEnterNewPhone .verify .resend",captchaBox:"#popEnterNewPhone .verify .phone_capt","403Label":".fbdn_tip",quotaTextLabel:"#quotaTextLabel",quotaLabel:"#quotaLabel",captchaURL:"/pass/auth/security/sendBindPhoneTicket",quotaURL:"/pass/sms/quota",captchaVerifyLabel:"",captchaVerifyURL:"",checkBindingURL:"",quotaCache:{},smsDisabled:false});G.render();$("#popEnterNewPhone .binding .btn_commom").click(function(W){W.preventDefault()});$("#btnUpdateEmail").click(l.proxy(function(W){W.stopPropagation();W.preventDefault();if(!C()){return}d("changeEmail");MiAccountVerification({url:"/pass/auth/security/bindSafeAddress?type=EM&userId="+$(".na-num").text(),user:$(".na-num").text(),deviceType:JSP_VAR.deviceType,success:l.proxy(function(){this.enterNewEmail()},this),fail:function(X){t(X)}})},this));$("#popEnterNewEmail .binding .new_email").on("focus click",function(W){$("#popEnterNewEmail .binding .err_tip:not(.empty_capt):not(.wng_capt)").hideError();$("#popEnterNewEmail .binding .new_email").parent().removeClass("error_bg")}).blur(l.proxy(function(Z){var W=$("#popEnterNewEmail");var Y=W.find(".binding");var X=$.trim(Z.target.value);if(!X){Y.find(".err_tip:not(.empty_capt):not(.wng_capt)").hideError();Y.find(".empty_email").showError();$(Z.target).parent().addClass("error_bg")}},this));$("#popEnterNewEmail .binding .capt_box").on("focus click",l.proxy(function(Y){clearTimeout(this.emailImageBlurTimer);var W=$("#popEnterNewEmail");var X=W.find(".binding");X.find(".err_tip.empty_capt, .err_tip.wng_capt").hideError();X.find(".capt_box").parent().removeClass("error_bg")},this)).blur(l.proxy(function(Y){var W=$("#popEnterNewEmail");var X=W.find(".binding");if(!$.trim(Y.target.value)){this.emailImageBlurTimer=setTimeout(function(){X.find(".err_tip.empty_capt, .err_tip.wng_capt").hideError();X.find(".empty_capt").showError();X.find(".capt_box").parent().addClass("error_bg")},200)}},this));$("#popEnterNewEmail .binding .chkcode_img, #popEnterNewEmail .binding .chkcode_img + a").click(l.proxy(function(X){X.preventDefault();clearTimeout(this.emailImageBlurTimer);var W=$("#popEnterNewEmail .binding .chkcode_img");W.attr("src",W.attr("_src")+"&_="+u.now())},this));$("#popEnterNewEmail .binding .btn_commom").click(l.proxy(this.onEnterNewEmail,this));var I=$("#popEnterNewEmail .binding .select-edm");I.click(l.proxy(function(W){if(I.hasClass("now")){I.removeClass("now")}else{I.addClass("now")}},this)).trigger("click");$("#popEnterNewEmail .verify .resend").click(l.proxy(this.onResendNewEmail,this));$("#popEnterNewEmail .verify .capt_box").on("focus click",l.proxy(function(Y){clearTimeout(this.emailCaptBlurTimer);var X=$("#popEnterNewEmail");var W=X.find(".verify");W.find(".err_tip").hideError();$("#popEnterNewEmail .verify .capt_box").parent().removeClass("error_bg")},this)).blur(l.proxy(function(Y){var X=$("#popEnterNewEmail");var W=X.find(".verify");if(!$.trim(Y.target.value)){this.emailCaptBlurTimer=setTimeout(function(){W.find(".empty_capt").showError();W.find(".capt_box").parent().addClass("error_bg")},200)}},this));$("#popEnterNewEmail .verify .btn_back, #popEnterNewEmail .btn_mod_close").click(l.proxy(this.cancelUpdateEmail,this));$("#popEnterNewEmail .verify .btn_commom").click(l.proxy(this.onVerifyNewEmail,this));$("#popEnterNewEmail .success .btn_commom").click(function(X){X.preventDefault();var W=$("#popEnterNewEmail");location.href="/"});var T=false;$("#btnSetMibao").click(l.proxy(function(W){W.stopPropagation();W.preventDefault();if(!C()){return}d("changeMibao");MiAccountVerification({url:"/pass/auth/security/setSafeQuestions?userId="+$(".na-num").text(),user:$(".na-num").text(),deviceType:JSP_VAR.deviceType,success:l.proxy(function(){if(!T){if(E){U.render();T=true;$("#popSetMibao form").bind("submit",D)}else{if(!C()){return}$.ajax({type:"GET",url:"/pass/auth/security/verifyQuestions",dataType:"text",data:{userId:$(".na-num").text(),_:+new Date},error:y,success:function(X){X=X.replace("&&&START&&&","");X=$.parseJSONSafe(X);if(X.result===0){window.mibaoData=window.pageData=X.info}U.render();T=true;$("#popSetMibao form").bind("submit",D)}})}}this.setMibao()},this),fail:function(X){t(X)}})},this));var J=$("#frmSetQuestions");var E=window.mibaoData||window.pageData;var U;U=this.setMibaoForm=new z.QuestionForm({form:J,ajax:true});var D=l.proxy(function(Y){var Z=$("#popAnswerMibao");var X=$("#popSetMibao select.iselect");var W=Z.find(".set_mibao li p");W.each(function(ab,ac){var aa=$(ac);aa.text(X[ab].value)});$("#popSetMibao").hidePopup();this.answerMibao()},this);$("#popAnswerMibao .input_bg input").bind("focus",function(W){$(W.target).closest("li").find(".error-mes").hide()});$("#popAnswerMibao .btn_back").click(function(W){W.preventDefault();$("#popAnswerMibao").hidePopup();$("#popSetMibao").showPopup();$("#popAnswerMibao .input_bg input").val("");return false});$("#popAnswerMibao .btn_commom").click(function(Y){Y.preventDefault();var W=$("#popAnswerMibao .form-error-mes");W.hide();var X=false;$("#popAnswerMibao .input_bg input").each(function(ab,ac){var aa=$(ac);var Z=aa.closest("li").find(".error-mes");var ad=aa.val();if(!ad){Z.text(s.getResource("answer_empty")).show();X=true}else{Z.text("").hide()}});if(X){return}if(!C()){return}$.ajax({url:"/pass/auth/security/setSafeQuestions",type:"POST",data:{userId:$(".na-num").text(),passport_ph:n.get("passport_ph")||"",usercenter_ph:n.get("usercenter_ph")||"",passportsecurity_ph:n.get("passportsecurity_ph")||"",passToken:n.get("passToken")||"",questions:$("#popSetMibao .form-data").val(),verifiedQuestions:(function(){var Z=[];$("#popAnswerMibao .input_bg input").each(l.proxy(function(ab,ac){var aa=$(ac);$question=aa.parent().parent().find("p");Z.push('{"q":"'+z.QuestionForm.addSlashes($question.html())+'","a":"'+z.QuestionForm.addSlashes(aa.val())+'"}')},this));return"["+Z.join(",")+"]"})()},dataType:"text",error:y,success:function(Z){Z=Z.replace("&&&START&&&","");Z=$.parseJSONSafe(Z);if(Z.result===0){W.hide();$("#popAnswerMibao").hidePopup();$("#popFinishMibao").showPopup();d("changeMibao","end")}else{switch(Z.result){case 1200305:W.text(s.getResource("wrong_answer")).show();break;case 5200306:case 5200307:case 5200308:W.text(s.getResource("jsp_2014_tip23")+"("+Z.result+")").show();break;default:}}}});return false});$("#popFinishMibao .btn_commom").click(function(W){W.preventDefault();location.href="/"});$("#btnManageToken").click(l.proxy(function(W){W.stopPropagation();W.preventDefault();if(!C()){return}d("enableTwoStepLogin");this.manageToken()},this));$(document.body).delegate("a[_href]","click",l.proxy(function(aa){aa.preventDefault();var Z=$(aa.target);var ac=$(Z.attr("_href"));var Y=Z.attr("_target")||"self";var ab=Z.parents(".mod_acc_tip",true);var X=ab.attr("id");var ad=ac.attr("id");function W(){ac.find(".disten30x76 img").removeAttr("src").removeAttr("_secret").removeAttr("_reset");ac.find("input[type=text]").val("");ac.find(".err_tip").hideError();ac.find(".input_bg").removeClass("error_bg");if(!C()){return}$.ajax({type:"get",url:"/pass/auth/security/genEnableSecret",data:{userId:$(".na-num").text(),reset:$("#btnManageToken a").attr("__href").indexOf("status")>-1},dataType:"text",error:y,success:function(ae){ae=ae.replace("&&&START&&&","");ae=$.parseJSONSafe(ae);if(ae.result===0){ac.find(".disten30x76 img").attr("src",ae.info.QRCodeUrl).attr("_secret",ae.info.secret).removeAttr("_reset");if(ab.attr("id")==="popManageTokenStatus"){ac.find(".disten30x76 img").attr("_reset",true)}ac.find(".err_tip").hideError();if(Y!=="_blank"){ab.hidePopup({dontAffectHash:true})}ac.showPopup()}else{ab.find(".sys_err").showError(ae.result)}}})}switch(ad){case"popManageTokenDownload":if($("#btnManageToken a").attr("__href").indexOf("status")>-1){$("#popManageTokenDownload .tip_btns").addClass("token_enabled")}else{$("#popManageTokenDownload .tip_btns").removeClass("token_enabled")}if(Y!=="_blank"){ab.hidePopup({dontAffectHash:true})}ac.showPopup();break;case"popManageTokenSetMobile":if(!C()){return}MiAccountVerification({url:"/pass/auth/security/setBackupPhone?userId="+$(".na-num").text(),user:$(".na-num").text(),deviceType:JSP_VAR.deviceType,success:l.proxy(function(){if(Y!=="_blank"){ab.hidePopup()}ac.hideError().showPopup();ac.find(".error_bg").removeClass("error_bg");ac.find(".err_tip").hideError()},this),fail:function(ae){t(ae)}});break;case"popManageTokenActivate":if(X==="popManageTokenStatus"){if(!C()){return}MiAccountVerification({url:"/pass/auth/security/enableTwoStepLogin?userId="+$(".na-num").text(),user:$(".na-num").text(),deviceType:JSP_VAR.deviceType,success:l.proxy(function(){W()},this),fail:function(ae){t(ae)}})}else{W()}break;case"popManageTokenKeys":ac.find(".mi_code span").remove();if(!C()){return}$.ajax({url:"/pass/auth/security/backupOtp",dataType:"text",type:"GET",data:{userId:$(".na-num").text(),_:+new Date},error:y,success:function(ag){ag=ag.replace("&&&START&&&","");ag=$.parseJSONSafe(ag);if(ag.result===0){var af=ag.info.codes;var ae=ac.find(".mi_code");$.each(af,function(ah,ai){if($.trim(ai)){ae.append("<span>"+ai+"&nbsp;&nbsp;&nbsp;&nbsp;</span>")}else{ae.append("<span _used>"+s.getResource("jsp_2014_token_used")+"</span>")}});if(ag.info.email){ac.find(".sendEmail").attr("href","mailto:"+ag.info.email)}if(Y!=="_blank"){ab.hidePopup()}ac.showPopup()}}});break;case"popEnterNewEmail":if(!C()){return}MiAccountVerification({url:"/pass/auth/security/bindSafeAddress?type=email&userId="+$(".na-num").text(),user:$(".na-num").text(),deviceType:JSP_VAR.deviceType,success:l.proxy(function(){if(Y!=="_blank"){ab.hidePopup()}this.enterNewEmail()},this),fail:function(ae){t(ae)}});break;case"popEnterNewPhone":if(!C()){return}MiAccountVerification({url:"/pass/auth/security/bindSafeAddress?type=phone&userId="+$(".na-num").text(),user:$(".na-num").text(),deviceType:JSP_VAR.deviceType,success:l.proxy(function(){if(Y!=="_blank"){ab.hidePopup()}this.enterNewPhone()},this),fail:function(ae){t(ae)}});break;case"popManageTokenDownAct":if($("#btnUpdateEmail a").attr("__href").indexOf("replace=true")===-1){if(Y!=="_blank"){ab.hidePopup()}$("#popManageTokenBindEmail").showPopup();return}if(!userPhoneList.length){if(Y!=="_blank"){ab.hidePopup()}$("#popManageTokenBindPhone").showPopup();return}if(!C()){return}MiAccountVerification({url:"/pass/auth/security/enableTwoStepLogin?userId="+$(".na-num").text(),user:$(".na-num").text(),deviceType:JSP_VAR.deviceType,beforeModal:function(){if(Y!=="_blank"){ab.hidePopup()}},success:l.proxy(function(){ac.find(".err_tip").hideError();ac.showPopup()},this),fail:function(ae){t(ae)}});break;default:ac.find(".err_tip").hideError();if(Y!=="_blank"){ab.hidePopup()}ac.showPopup()}},this));$("#popManageTokenDownload .newtab a").click(function(Y){Y.preventDefault();$("#popManageTokenDownload .newtab a").removeClass("now");var X=$(Y.target);X.addClass("now");var W=X.index();$($("#popManageTokenDownload .tabcon").hide()[W]).show()});$("#popManageTokenActivate input[type=text]").on("focus click",function(W){$("#popManageTokenActivate .err_tip").hideError();$("#popManageTokenActivate .input_bg").removeClass("error_bg")}).blur(function(W){if(!$.trim(W.target.value)){$("#popManageTokenActivate .empty_capt").showError();$("#popManageTokenActivate .input_bg").addClass("error_bg")}});$("#popManageTokenActivate .btn_commom").click(function(X){X.preventDefault();$("#popManageTokenActivate .err_tip").hideError();$("#popManageTokenActivate .input_bg").removeClass("error_bg");var W=$.trim($("#popManageTokenActivate input[type=text]").val());if(!W){$("#popManageTokenActivate .empty_capt").showError();$("#popManageTokenActivate .input_bg").addClass("error_bg");return}if(!C()){return}$.ajax({dataType:"text",url:"/pass/auth/security/checkCode",type:"POST",data:{passport_ph:n.get("passport_ph")||"",usercenter_ph:n.get("usercenter_ph")||"",passportsecurity_ph:n.get("passportsecurity_ph")||"",passToken:n.get("passToken")||"",userId:$(".na-num").text(),secret:$("#popManageTokenActivate .disten30x76 img").attr("_secret"),code:W},error:y,success:function(Y){Y=Y.replace("&&&START&&&","");Y=$.parseJSONSafe(Y);if(Y.result===0){if(!C()){return}MiAccountVerification({url:"/pass/auth/security/enableTwoStepLogin?userId="+$(".na-num").text(),user:$(".na-num").text(),deviceType:JSP_VAR.deviceType,success:function(){$("#popManageTokenActivate").hidePopup();$("#popManageTokenTrustDevice .mod_trust i").addClass("icon_true");$("#popManageTokenTrustDevice").showPopup()},fail:function(Z){t(Z)}})}else{$("#popManageTokenActivate .err_tip").hideError();$("#popManageTokenActivate .input_bg").addClass("error_bg");switch(Y.result){case 1200413:case 1200414:$("#popManageTokenActivate .wng_capt").showError(Y.result);break;case 5200415:case 5000000:$("#popManageTokenActivate .sys_err").showError(Y.result);break;default:}}}})});$("#popManageTokenTrustDevice .btn_commom").click(function(W){W.preventDefault();if(!C()){return}$.ajax({url:"/pass/auth/security/enableTwoStepLogin",type:"post",dataType:"text",data:{passport_ph:n.get("passport_ph")||"",usercenter_ph:n.get("usercenter_ph")||"",passportsecurity_ph:n.get("passportsecurity_ph")||"",passToken:n.get("passToken")||"",userId:$(".na-num").text(),secret:$("#popManageTokenActivate .disten30x76 img").attr("_secret"),reset:!!$("#popManageTokenActivate .disten30x76 img").attr("_reset"),isTrustEnable:!!$("#popManageTokenTrustDevice .mod_trust .icon_true").length,code:$("#popManageTokenActivate input[type=text]").val()},error:y,success:function(X){X=X.replace("&&&START&&&","");X=$.parseJSONSafe(X);if(X.result===0){$("#popManageTokenTrustDevice").hidePopup();var Y=new u.Countdown({duration:10000,onProgress:function(Z){$("#popManageTokenFinish .logoutCountdown").text(Math.round(Z.timeLeft/1000))},onComplete:function(){location.href="/"}});Y.start();$("#popManageTokenFinish .err_tip").hideError();$("#popManageTokenFinish").showPopup();d("enableTwoStepLogin","end")}else{switch(X.result){case 5200430:$("#popManageTokenTrustDevice .wng_capt").showError(X.result);break;default:$("#popManageTokenTrustDevice .sys_err").showError(X.result)}}}})});$("#popManageTokenStatus .tip_btns .btn_disable_token").click(function(W){W.preventDefault();$("#popManageTokenStatus").hidePopup();if(!C()){return}MiAccountVerification({url:"/pass/auth/security/disableTwoStepLogin?userId="+$(".na-num").text(),user:$(".na-num").text(),deviceType:JSP_VAR.deviceType,success:l.proxy(function(){$("#popManageTokenStatus .sys_err").hideError();if(!C()){return}$.ajax({url:"/pass/auth/security/disableTwoStepLogin",type:"POST",dataType:"text",data:{passport_ph:n.get("passport_ph")||"",usercenter_ph:n.get("usercenter_ph")||"",passportsecurity_ph:n.get("passportsecurity_ph")||"",passToken:n.get("passToken")||"",userId:$(".na-num").text()},error:y,success:function(X){X=X.replace("&&&START&&&","");X=$.parseJSONSafe(X);$("#popManageTokenStatus").showPopup();if(X.result===0){$("#popManageTokenStatus").hidePopup();$("#popManageTokenDisableFinish").showPopup()}else{switch(X.result){case 5200433:case 5200434:case 5200456:case 5200457:case 5200458:case 5000000:$("#popManageTokenStatus .sys_err").showError(X.result);break;default:}}}})},this),fail:function(X){$("#popManageTokenStatus").showPopup();t(X)}})});$("#popManageTokenKeys #refresh_code").click(function(X){X.preventDefault();var W=$("#popManageTokenKeys .mi_code");if(!C()){return}$.ajax({type:"POST",url:"/pass/auth/security/refreshBackupOtp",dataType:"text",data:{passport_ph:n.get("passport_ph")||"",usercenter_ph:n.get("usercenter_ph")||"",passportsecurity_ph:n.get("passportsecurity_ph")||"",passToken:n.get("passToken")||"",userId:$(".na-num").text()},error:y,success:function(Z){Z=Z.replace("&&&START&&&","");Z=$.parseJSONSafe(Z);if(Z.result===0){W.find("span").remove();var Y=Z.info.codes;$.each(Y,function(aa,ab){if($.trim(ab)){W.append("<span>"+ab+"&nbsp;&nbsp;&nbsp;&nbsp;</span>")}else{W.append("<span _used>"+s.getResource("jsp_2014_token_used")+"</span>")}})}}})});$("#popManageTokenSetMobile .set_qst_tit").click(function(W){$("#popManageTokenSetMobile .country-container").toggle();W.stopPropagation();W.preventDefault()});$("#popManageTokenSetMobile .backupPhoneInput").on("focus click",function(W){$("#popManageTokenSetMobile .err_tip").hideError();$("#popManageTokenSetMobile .input_bg").removeClass("error_bg")});$("#popManageTokenSetMobile .btn_commom").click(l.proxy(function(Z){Z.preventDefault();var aa=$("#popManageTokenSetMobile"),ab=aa.find(".backupPhoneInput");var W=ab.val();if(!W){aa.find(".empty_phone").showError();$("#popManageTokenSetMobile .input_bg").addClass("error_bg");return}if(!/^\d+$/.test(W)){aa.find(".wng_fmt").showError();$("#popManageTokenSetMobile .input_bg").addClass("error_bg");return}var Y=$.trim(aa.find(".c_b em").text());if(Y==="+86"){Y=""}var X=Y+W;if(!C()){return}$.ajax({type:"POST",dataType:"text",url:"/pass/auth/security/setBackupPhone",data:{passport_ph:n.get("passport_ph")||"",usercenter_ph:n.get("usercenter_ph")||"",passportsecurity_ph:n.get("passportsecurity_ph")||"",passToken:n.get("passToken")||"",userId:$(".na-num").text(),phone:X,replace:$("#popManageTokenStatus li:first-child dd").hasClass(".has_fb_mobile")},error:y,success:l.proxy(function(ac){ac=ac.replace("&&&START&&&","");ac=$.parseJSONSafe(ac);aa.find(".err_tip").hideError();aa.find(".backupPhoneInput").val("");if(ac.result===0){$("#popManageTokenStatus li:first-child dd .fb_mobile span").text(X);$("#popManageTokenStatus li:first-child dd").addClass("has_fb_mobile");aa.hideError();aa.hidePopup();this.manageToken()}else{$("#popManageTokenSetMobile .input_bg").addClass("error_bg");switch(ac.result){case 1200444:$("#popManageTokenSetMobile .empty_phone").showError(ac.result);break;case 1200445:$("#popManageTokenSetMobile .wng_fmt").showError(ac.result);break;case 1200446:$("#popManageTokenSetMobile .bad_param").showError(ac.result);break;case 1200448:$("#popManageTokenSetMobile .dupl_phone").showError(ac.result);break;case 1200449:$("#popManageTokenSetMobile .set_fail").showError(ac.result);break;case 5200451:case 5200450:case 5200447:case 5000000:$("#popManageTokenSetMobile .sys_err").showError(ac.result);break;default:$("#popManageTokenSetMobile .set_fail").showError(ac.result)}}},this)})},this));$("#popManageTokenStatus .delBackupPhone").click(function(W){W.preventDefault();if(!C()){return}MiAccountVerification({url:"/pass/auth/security/deleteBackupPhone?userId="+$(".na-num").text(),user:$(".na-num").text(),deviceType:JSP_VAR.deviceType,success:l.proxy(function(){$("#popManageTokenStatus .sys_err").hideError();if(!C()){return}$.ajax({url:"/pass/auth/security/deleteBackupPhone",dataType:"text",type:"POST",data:{passport_ph:n.get("passport_ph")||"",usercenter_ph:n.get("usercenter_ph")||"",passportsecurity_ph:n.get("passportsecurity_ph")||"",passToken:n.get("passToken")||"",userId:$(".na-num").text()},error:y,success:function(X){X=X.replace("&&&START&&&","");X=$.parseJSONSafe(X);if(X.result===0){$("#popManageTokenStatus li:first-child dd .fb_mobile span").text("");$("#popManageTokenStatus li:first-child dd").removeClass("has_fb_mobile")}else{switch(X.result){case 5200452:case 5200453:case 5200455:case 5000000:$("#popManageTokenStatus .sys_err").showError(X.result);break;case 1200454:$("#popManageTokenStatus .backup_phone_not_exists").showError(X.result);break;default:}}}})},this),fail:function(X){t(X)}})});$("#popManageTokenKeys .sendEmail").click(function(Y){var X=[];$("#popManageTokenKeys .mi_code span:not([_used])").each(function(aa,ab){X.push($.trim($(ab).text()))});var Z="?subject="+encodeURIComponent(s.getResource("jsp_2014_my_backup_keys"))+"&body="+X.join("       ");var W=Y.target.href;if(W.indexOf("subject=")===-1){W+=Z}else{W=W.replace(/\?.*$/g,Z)}Y.target.href=W});$("#popUpdatePassword .oldPass, #popUpdatePassword .newPass, #popUpdatePassword .newPass2, #popUpdatePassword .capt_box").keypress(function(W){if(W.keyCode===13){W.preventDefault();$("#popUpdatePassword .btnOK").click()}});$("#popEnterNewEmail .binding .new_email, #popEnterNewEmail .binding .capt_box").keypress(function(W){if(W.keyCode===13){W.preventDefault();$("#popEnterNewEmail .binding .btn_commom").click()}});$("#popEnterNewEmail .verify .capt_box").keypress(function(W){if(W.keyCode===13){W.preventDefault();$("#popEnterNewEmail .verify .btn_commom").click()}});$("#popEnterNewPhone .binding .new_phone, #popEnterNewPhone .binding .capt_box").keypress(function(W){if(W.keyCode===13){W.preventDefault();$("#popEnterNewPhone .binding .btn_commom").click()}});$("#popEnterNewPhone .verify .phone_capt").keypress(function(W){if(W.keyCode===13){W.preventDefault();$("#popEnterNewPhone .verify .btn_commom").click()}});$("#printKeys").click(function(W){W.preventDefault();window.print()});var M=$("#popManageTokenStatus");var V=$("#popManageTokenKeys");$(window).resize(u.debounce(function(){M.positionPopup();V.positionPopup()}));$("#popVeriFailed .btn_back").click(function(X){X.preventDefault();var W=$(X.target);var Y=W.closest(".mod_acc_tip");Y.hidePopup()})},resetUpdatePasswordForm:function(D){D=D||{};var E=$("#popUpdatePassword");E.find(".error_bg").removeClass("error_bg");E.find(".grpOldPass .err_tip, .capt_box .err_tip").hideError();if(!D.keepInputs){E.find("input[type=text], input[type=password]").val("")}},nextUpdatePasswordCaptcha:function(F){var E=$("#popUpdatePassword .chkcode_img");var D=E.attr("src")||"/pass/getCode?icodeType=login&_t=0";D=D.replace(/_t\=\d*/g,"_t="+(+new Date));E.attr("src",D)},onUpdatePasswordSuccess:function(){$("#popUpdatePassword").hidePopup();$("#popUpdatePasswordSuccess").showPopup();var D=new u.Countdown({duration:10000,onProgress:function(E){$("#popUpdatePasswordSuccess .logoutCountdown").text(Math.round(E.timeLeft/1000))},onComplete:function(){location.href="/"}});D.start();d("changePassword","end")},onOldPasswordWrong:function(D){$("#popUpdatePassword .grpOldPass .wng_pwd").showError(D);$("#popUpdatePassword .oldPass").parent().addClass("error_bg");$("#popUpdatePassword .capt_box .chkcode input").val("")},onUpdatePasswordCaptchaWrong:function(D){$("#popUpdatePassword .capt_box .wng_capt").showError(D);$("#popUpdatePassword .capt_box .chkcode").addClass("error_bg");$("#popUpdatePassword .capt_box .chkcode input").val("");$("#popUpdatePassword .grpOldPass label").removeClass("error_bg");$("#popUpdatePassword .grpOldPass .wng_pwd").hideError()},updatePasswordAttempts:0,MAX_UPDATE_CAPTLESS_ATTEMPTS:3,onUpdatePasswordSystemError:function(D){$("#popUpdatePassword .sys_err").showError(D)},onUpdatePasswordTooMuchError:function(D){$("#popUpdatePassword .too_much").showError(D)},onUpdatePasswordEmailDisallowedError:function(D){$("#popUpdatePassword .eq_email").showError(D)},pwdInBlackList:function(D){$("#popUpdatePassword .pwd_in_black").showError(D)},repwdFormatError:function(D){$("#popUpdatePassword .repwd_format_error").showError(D);$("#popUpdatePassword .newPass").parent().addClass("error_bg")},pwdRiskError:function(D){$("#popUpdatePassword .pwd_risk_error").showError(D)},onUpdatePassword:function(D){if(!this.checkOldPassword()||!this.checkNewPasswords(D)){return false}var E=$("#popUpdatePassword");if(E.find(".oldPass").val()===E.find(".newPass").val()){E.find(".same_pwd").showError();E.find(".grpNewPass label").addClass("error_bg");return false}if($("#popUpdatePassword .capt_box").css("display")!=="none"){if(!this.checkPasswordCaptcha()){return false}}this.resetUpdatePasswordForm({keepInputs:true});if(!C()){return}$.ajax({url:"/pass/auth/security/changePassword",type:"POST",dataType:"text",data:{passport_ph:n.get("passport_ph")||"",usercenter_ph:n.get("usercenter_ph")||"",passportsecurity_ph:n.get("passportsecurity_ph")||"",passToken:n.get("passToken")||"",userId:$(".na-num").text(),oldPassword:$("#popUpdatePassword .oldPass").val(),password:$("#popUpdatePassword .newPass").val(),icode:$.trim($("#popUpdatePassword .chkcode input").val())},error:y,success:l.proxy(function(G){G=G.replace("&&&START&&&","");G=$.parseJSONSafe(G);var F=G.result;if(F===0){this.onUpdatePasswordSuccess()}else{switch(F){case 110021001:case 110041001:case 1200106:this.onOldPasswordWrong(G.result);break;case 1200102:this.repwdFormatError(G.result);break;case 1200107:case 1200105:this.onUpdatePasswordCaptchaWrong(G.result);break;case 550065002:case 550001008:case 550025000:case 550065000:case 5200107:case 5200108:case 5200109:case 5200111:case 5000000:this.onUpdatePasswordSystemError(G.result);break;case 4200104:this.onUpdatePasswordTooMuchError(G.result);break;case 1200110:this.pwdRiskError(G.result);break;case 4200112:this.pwdInBlackList(G.result);break;default:}if(G.info&&G.info.captchaUrl){this.requirePasswordCaptcha(G.info.captchaUrl)}}},this)});return true},checkOldPassword:function(){var D=$("#popUpdatePassword .oldPass").val();if(!D){$("#popUpdatePassword .grpOldPass .empty_pwd").showError();$("#popUpdatePassword .grpOldPass label").addClass("error_bg")}else{$("#popUpdatePassword .grpOldPass .empty_pwd").hideError();$("#popUpdatePassword .grpOldPass label").removeClass("error_bg")}return !!D},checkNewPasswords:function(J){var I=$("#popUpdatePassword .newPass").val(),D=$("#popUpdatePassword .newPass2").val();if(!I){if(!$(J.target).hasClass(".newPass")){$("#popUpdatePassword .grpNewPass .empty_pwd").showError();$("#popUpdatePassword .newPass").parent().addClass("error_bg")}return false}else{$("#popUpdatePassword .grpNewPass .empty_pwd").hideError();$("#popUpdatePassword .newPass").parent().removeClass("error_bg")}if(!D){$("#popUpdatePassword .grpNewPass .empty_pwd2").showError();$("#popUpdatePassword .newPass2").parent().addClass("error_bg");return false}else{$("#popUpdatePassword .grpNewPass .empty_pwd2").hideError();$("#popUpdatePassword .newPass2").parent().removeClass("error_bg")}if(I!==D){$("#popUpdatePassword .grpNewPass .pwd_mismatch").showError();$("#popUpdatePassword .newPass2").parent().addClass("error_bg");return false}else{$("#popUpdatePassword .grpNewPass .pwd_mismatch").hideError();$("#popUpdatePassword .newPass2").parent().removeClass("error_bg")}var F=/\d/g,E=/[a-zA-Z]/g,H=/[^0-9a-zA-Z]/g;var G=0+F.test(I)+E.test(I)+H.test(I);if(G<2||I.length<8||I.length>16){$("#popUpdatePassword .grpNewPass .pwd_fmt").showError();$("#popUpdatePassword .grpNewPass .txt_tip").hide();$("#popUpdatePassword .newPass").parent().addClass("error_bg");$("#popUpdatePassword .newPass2").parent().addClass("error_bg");return false}else{$("#popUpdatePassword .grpNewPass .pwd_fmt").hideError();$("#popUpdatePassword .grpNewPass .txt_tip").show();$("#popUpdatePassword .newPass").parent().removeClass("error_bg");$("#popUpdatePassword .newPass2").parent().removeClass("error_bg")}return true},checkPasswordCaptcha:function(){var D=$.trim($("#popUpdatePassword .chkcode input").val());if(!D){$("#popUpdatePassword .capt_box .empty_capt").showError();$("#popUpdatePassword .capt_box .chkcode").addClass("error_bg");return false}else{$("#popUpdatePassword .capt_box .empty_capt").hideError();$("#popUpdatePassword .capt_box .chkcode").removeClass("error_bg")}return true},requirePasswordCaptcha:function(D){D=D||"/pass/getCode?icodeType=login";D+="&_t="+(+new Date);$("#popUpdatePassword .capt_box .chkcode_img").attr("src",D);$("#popUpdatePassword .capt_box").show()},checkBindStatus:function(F,J,K,I){var E=F.find(".bind-info-panel");var H=$.trim(J.find(".set_qst_tit em").text());var G=$.trim(J.find(".capt_box").val());if(H==="+86"){H=""}var D=H+K;$.ajax({url:"/pass/auth/security/checkUserBindInfo",type:"POST",dataType:"text",data:{userId:$(".na-num").text(),addressType:I,newAddress:D,icode:G,passport_ph:n.get("passport_ph")||"",usercenter_ph:n.get("usercenter_ph")||"",passportsecurity_ph:n.get("passportsecurity_ph")||""},success:l.proxy(function(L){L=$.parseJSONSafe(L.replace("&&&START&&&",""));if(L.result===0){var L=L.info;if(L.times===0){p(J.find(".new_phone"),"bindLeftTimes")}else{if(L&&L.userId&&/\*+/.test(L.userId)){E.find(".bind-time").text(L.ts);E.find(".bind-id").text(L.userId);J.hide();E.show()}else{this.checkNewPhone()}}}else{if(L.result===1200262){J.find(".chkcode_img").click();J.find(".capt_box").val("");p(J.find(".capt_box"),"icode_rule")}else{if(L.result===1200263){p(J.find(".new_phone"),"phone_rule",L.result)}else{if(L.result===5200264||L.result===5200265||L.result===5200266){p(J.find(".capt_box"),"error_system",L.result,true)}else{p(J.find(".capt_box"),"error_system",L.result,true)}}}}},this)})},checkNewPhone:function(){var M=$("#popEnterNewPhone");var H=M.find(".binding");var D=M.find(".bind-info-panel");var L=H.find(".new_phone").val();var J=$.trim(H.find(".set_qst_tit em").text());if(J==="+86"){J=""}var F=J+L;var K=J;if(!K){K="+86"}var G=M.find(".verify");G.find(".disten30x103 h6 em").text(" "+K+" "+L+" ");G.find(".err_tip").hide();$("#popEnterNewPhone .binding .full_new_phone").val(J+L);var I=this.updatePhoneSMSSender;var E=this.updatePhoneSMSSender.quotaCache[F];if(typeof E==="number"){if(E>0){this.updatePhoneSMSSender.onSendSMS()}else{p(H.find(".new_phone"),"reachMax");D.hide();H.show();return false}}},checkQuota:function(D){if(!C()){return}var I=$("#popEnterNewPhone .binding");var E=I.find(".new_phone").val();var G=$.trim(I.find(".set_qst_tit em").text());if(G==="+86"){G=""}var F=G+E;$("#popEnterNewPhone .binding .full_new_phone").val(F);var H=this.updatePhoneSMSSender;$.ajax({url:H.quotaURL,dataType:"text",type:"POST",data:H.getQuotaPostData?H.getQuotaPostData():{address:H.$phoneBox.val(),contentType:H.type,userId:H.type?H.$userBox.val():-1},error:y,success:l.proxy(function(K){K=$.parseJSONSafe(K.replace("&&&START&&&",""));var J=+K.info||0;H.quotaCache[F]=J;H.showQuota(H.quotaCache[F]);if(K.result===0){D&&D(parseInt(K.info)||0)}else{D&&D(0)}},this)})},checkNewEmail:function(H){var F=this;var D=$("#popEnterNewEmail");var G=D.find(".binding");var E=G.find(".new_email").val();if(!E){G.find(".empty_email").showError();return false}if(!/^[\w.\-]+@(?:[a-z0-9]+(?:-[a-z0-9]+)*\.)+[a-z]{2,6}$/.test(E)){G.find(".wng_fmt").showError();return false}if(!C()){return}H();return;$.ajax({url:"/pass/auth/security/checkSafeAddressParams",type:"POST",data:{passport_ph:n.get("passport_ph")||"",usercenter_ph:n.get("usercenter_ph")||"",passportsecurity_ph:n.get("passportsecurity_ph")||"",passToken:n.get("passToken")||"",addressType:"EM",userId:$(".na-num").text(),newAddress:E,icode:$.trim(G.find(".capt_box").val()),replace:$("#btnUpdateEmail a").attr("__href").indexOf("replace=true")>-1},dataType:"text",error:y,success:l.proxy(function(J){J=J.replace("&&&START&&&","");J=$.parseJSONSafe(J);if(J.result===0){if(H){H()}}else{var I=$("#popEnterNewEmail .binding .chkcode_img");I.attr("src",I.attr("src")+"&_="+u.now());$("#popEnterNewEmail .binding .capt_box").val("").parent().addClass("error_bg");clearTimeout(F.emailImageBlurTimer);switch(J.result){case 1200216:G.find(".wng_fmt").showError(J.result);break;case 1200205:G.find(".email_bound").showError(J.result);break;case 1200207:G.find(".email_bound_elsewhere").showError(J.result);break;case 5200203:case 5200204:case 5200206:case 5000000:G.find(".sys_err").showError(J.result);break;case 1200201:G.find(".wng_capt").showError(J.result);break;case 1200202:G.find(".bad_param").showError(J.result);break;default:}}},this)})},onEnterNewPhone:function(I){var E=$("#popEnterNewPhone");var H=E.find(".binding");H.find(".err_tip").hideError();var D=H.find(".new_phone").val();var G=$.trim(H.find(".set_qst_tit em").text()||"");if(G==="+86"){G=""}var F=G+D;if(!o(H)){return false}this.updatePhoneSMSSender.onResend=false;if(typeof this.updatePhoneSMSSender.quotaCache[F]==="number"){if(this.updatePhoneSMSSender.quotaCache[F]===0){p(H.find(".new_phone"),"reachMax")}else{this.checkBindStatus(E,H,D,"PH")}}else{this.checkQuota(l.proxy(function(J){if(J===0){p(H.find(".new_phone"),"reachMax")}else{this.updatePhoneSMSSender.smsDisabled=true;this.checkBindStatus(E,H,D,"PH")}},this))}if(I){I.preventDefault()}return false},onVerifyNewEmail:function(I){if(I){I.preventDefault()}var H=this;var E=$("#popEnterNewEmail");var D=E.find(".verify");var G=E.find(".success");var F=$.trim(D.find(".capt_box").val());if(!F){D.find(".empty_capt").showError();D.find(".capt_box").parent().addClass("error_bg");return}if(!C()){return}$.ajax({type:"post",dataType:"text",url:"/pass/auth/security/bindSafeAddress",data:{vkey:$.trim(D.find(".capt_box").val()),userId:$(".na-num").text(),newAddress:$("#popEnterNewEmail .binding .new_email").val(),passport_ph:n.get("passport_ph")||"",usercenter_ph:n.get("usercenter_ph")||"",passportsecurity_ph:n.get("passportsecurity_ph")||"",passToken:n.get("passToken")||"",addressType:"EM",edm:$("#popEnterNewEmail .binding .select-edm").hasClass("now")?"true":"false",replace:$("#btnUpdateEmail a").attr("__href").indexOf("replace=true")>-1},error:y,success:function(J){J=J.replace("&&&START&&&","");J=$.parseJSONSafe(J);if(J.result===0){D.find(".capt_box").parent().removeClass("error_bg");$(E.find(".tab_opt span").removeClass("now")[2]).addClass("now");$(E.find(".tabline i").removeClass("now")[2]).addClass("now");D.hide();G.show();d("changeEmail","end")}else{D.find(".err_tip").hideError();D.find(".capt_box").parent().addClass("error_bg");switch(J.result){case 1200212:D.find(".wng_capt").showError(J.result);break;case 5200213:case 5200214:case 5000000:D.find(".sys_err").showError(J.result);break;default:}}}})},onVerifyNewPhone:function(J){if(J){J.preventDefault()}var F=$("#popEnterNewPhone");var D=F.find(".verify");var G=F.find(".success");if(!o(D)){return false}var H=$("#popEnterNewPhone").data("action")==="update"?"/pass/auth/security/updatePhone":"/pass/auth/security/addPhone";var I=$("#popEnterNewPhone").data("phone");var K=$("#popEnterNewPhone").data("key");if(!C()){return}var E=$.trim($("#popEnterNewPhone .binding .full_new_phone").val());$.ajax({type:"POST",dataType:"text",url:H,data:{userId:$(".na-num").text(),vkey:$.trim($("#popEnterNewPhone .verify .phone_capt").val()),passport_ph:n.get("passport_ph")||"",usercenter_ph:n.get("usercenter_ph")||"",passportsecurity_ph:n.get("passportsecurity_ph")||"",newPhone:E,oldPhoneKey:K,oldPhone:I,phone:E},error:y,success:function(L){L=L.replace("&&&START&&&","");L=$.parseJSONSafe(L);if(L.result===0){$(F.find(".tab_opt span").removeClass("now")[2]).addClass("now");$(F.find(".tabline i").removeClass("now")[2]).addClass("now");D.hide();G.show();d("changePhone","end")}else{F.find(".verify .err_tip").hideError();switch(L.result){case 4200219:case 4200243:case 4200250:p(D.find("input[name=ticket]"),"phoneBindTomuch");break;case 1200212:case 1200241:case 1200248:p(D.find("input[name=ticket]"),"ticket_resError");break;default:p(D.find("input[name=ticket]"),"error_system",L.result)}}}});return false},reloadUpdatePhoneCaptcha:function(E){clearTimeout(this.phoneImageBlurTimer);var D=$("#popEnterNewPhone .chkcode_img");var F=D.attr("src");if(F.indexOf("?")===-1){F+="?"}else{F+="&"}F+="_="+(+new Date);D.attr("src",F);$("#popEnterNewPhone .capt_box").val("");if(E){E.preventDefault()}return false},cancelUpdatePhone:function(E){$("#popEnterNewPhone").hidePopup();var D=this.updatePhoneSMSSender;D.countdown&&D.countdown.stop();D.sendTimes=0;if(E){E.preventDefault()}return false},showTip:function(D){},hideTip:function(D){},editPassword:function(){if(!C()){return}$.ajax({url:"/pass/auth/security/changePassword",type:"get",dataType:"text",data:{userId:$(".na-num").text()},error:y,success:l.proxy(function(D){D=D.replace("&&&START&&&","");D=$.parseJSONSafe(D);if(D.result===0){var E=$("#popUpdatePassword");E.showPopup().find(".err_tip").hide();E.find(".grpNewPass .txt_tip").show();if(D.info.captchaUrl){this.requirePasswordCaptcha(D.info.captchaUrl)}else{$("#popUpdatePassword .capt_box").hide()}}},this)})},updatePassword:function(){},editEmail:function(){},updateEmail:function(){},enterNewPhone:function(D){window.console&&window.console.log&&window.console.log(D);var F=$("#popEnterNewPhone");if(D.action){F.data("action",D.action);F.data("phone",D.phone);F.data("key",D.key)}$(F.find(".tab_opt span").removeClass("now")[0]).addClass("now");$(F.find(".tabline i").removeClass("now")[0]).addClass("now");F.find(".binding").show();F.find(".bind-info-panel").hide();F.find(".verify").hide();F.find(".success").hide();F.find("input").val("");F.find(".error_bg").removeClass("error_bg");F.find(".err_tip").hideError();var E=F.find(".chkcode_img");E.attr("src",E.attr("_src")+"&_="+u.now());F.showPopup()},enterNewEmail:function(){var E=$("#popEnterNewEmail");$(E.find(".tab_opt span").removeClass("now")[0]).addClass("now");$(E.find(".tabline i").removeClass("now")[0]).addClass("now");E.find(".binding").show();E.find(".verify").hide();E.find(".success").hide();E.find("input").val("");E.find(".error_bg").removeClass("error_bg");E.find(".err_tip").hideError();var D=E.find(".chkcode_img");D.attr("src",D.attr("_src")+"&_="+u.now());E.showPopup()},setMibao:function(){var F=$("#popSetMibao");F.find(".error-mes").html("").hide();var D=$("#frmSetQuestions ul > li");D.each(function(H,I){var G=$(I);var J=G.find('dd[_type^="-"]');if(!J.length){J=G.find("dd.def-opt")}J.click()});$("#frmSetQuestions").trigger("reset");F.showPopup();var E=$("#popAnswerMibao");E.find("li label input").val("");E.find("li > p").html("")},answerMibao:function(E){var F=$("#popAnswerMibao");F.find(".error-mes").text("").hide();if(E&&E.list&&E.list.length){var D=F.find(".set_mibao li p");D.each(function(G,H){$(H).text(E.list[G].q)})}F.showPopup()},manageToken:function(){var F;var D=$("#btnManageToken a");var E=D.attr("__href");if(E.indexOf("status")>-1){F=$("#popManageTokenStatus")}else{if(E.indexOf("explain")>-1){F=$("#popManageTokenHome")}}if(F){if(F.attr("id")==="popManageTokenStatus"){if(!C()){return}$.ajax({url:"/pass/auth/security/twoStepLoginStatus",type:"GET",dataType:"text",data:{userId:$(".na-num").text(),_:+new Date},error:y,success:function(G){G=G.replace("&&&START&&&","");G=$.parseJSONSafe(G);var H=G.info.hasBackupPhone;if(H){F.find("li:first-child dd .fb_mobile span").text(G.info.backupPhone);F.find("li:first-child dd").addClass("has_fb_mobile")}else{F.find("li:first-child dd").removeClass("has_fb_mobile")}F.find(".err_tip").hideError();F.showPopup()}})}else{F.find(".err_tip").hideError();F.showPopup()}}},confirmMibao:function(){var D=$("#popAnswerMibao");D.showPopup()},emailSendTimes:0,emailCaptBlurTimer:null,sendLeftTimes:null,onResendNewEmail:function(K){clearInterval(this.emailCaptBlurTimer);var D=$("#popEnterNewEmail");var L=D.find(".resend");var G=D.find(".verify");var J=D.find(".binding");var M=$("#emailQuotaTextLabel");if(!C()){return}var F={};!this.emailSendTimes&&(F.icode=J.find(".capt_box").val());var E=l.proxy(function(){$.ajax({url:"/pass/sms/quota",dataType:"text",type:"POST",data:{address:D.find(".new_email").val(),contentType:150007,userId:$(".na-num").text()},error:y,success:l.proxy(function(O){O=O.replace("&&&START&&&","");O=$.parseJSONSafe(O);if(O.result==0){var N=+O.info||0;this.sendLeftTimes=N}},this)})},this);var H=l.proxy(function(N){if(N<=2){M.show();var O=M.text().replace("{left}",N);M.text(O)}else{M.hide()}},this);var I=l.proxy(function(){$.ajax({type:"POST",url:"/pass/auth/security/sendSafeAddressTicket",data:$.extend({passport_ph:n.get("passport_ph")||"",usercenter_ph:n.get("usercenter_ph")||"",passportsecurity_ph:n.get("passportsecurity_ph")||"",passToken:n.get("passToken")||"",userId:$(".na-num").text(),newAddress:D.find(".new_email").val(),addressType:"EM",replace:$("#btnUpdateEmail a").attr("__href").indexOf("replace=true")>-1},F),dataType:"text",error:y,success:l.proxy(function(R){R=R.replace("&&&START&&&","");R=$.parseJSONSafe(R);var N=R.result||R.code;if(R.result===0){L.addClass("noSend");var Q=60000+60000*this.emailSendTimes++,O=100;var T=new Date;var S=L.attr("title");this.timer=setInterval(l.proxy(function(){var U=new Date;var W=U-T;var V=Q/1000-Math.round(W/1000);if(V>0){L.text(S+"("+V+")")}else{L.removeClass("noSend").text(S);clearInterval(this.timer)}},this),O);$(D.find(".tab_opt span").removeClass("now")[1]).addClass("now");$(D.find(".tabline i").removeClass("now")[1]).addClass("now");this.sendLeftTimes=Math.max(this.sendLeftTimes-1,0);if(this.sendLeftTimes===0){L.addClass("noSend").text(S);clearInterval(this.timer)}H(this.sendLeftTimes);J.hide();G.show()}else{G.find(".err_tip").hideError();var P=J.find(".chkcode_img");P.attr("src",P.attr("src")+"&_="+u.now());L.removeClass("noSend").text(S);clearInterval(this.timer);if(N===1200201||N===87001){J.find(".capt_box").val("").parent().addClass("error_bg");J.find(".wng_capt").showError(N)}switch(R.result){case 1200216:case 1200258:J.find(".new_email").val("").parent().addClass("error_bg");J.find(".wng_fmt").showError(R.result);break;case 1200205:case 1200259:J.find(".new_email").val("").parent().addClass("error_bg");J.find(".email_bound").showError(R.result);break;case 1200207:case 1200260:J.find(".new_email").val("").parent().addClass("error_bg");J.find(".email_bound_elsewhere").showError(R.result);break;case 5200203:case 5200204:case 5200206:case 5200261:case 5000000:J.find(".sys_err").showError(R.result);break;case 1200201:J.find(".capt_box").val("").parent().addClass("error_bg");J.find(".wng_capt").showError(R.result);break;case 1200202:J.find(".bad_param").showError(R.result);break;case 1200210:J.find(".new_email").val("").parent().addClass("error_bg");J.find(".err_tip.reach_max").showError(R.result);break;default:}switch(R.result){case 5200209:case 5000000:G.find(".err_tip.sys_err").showError(R.result);break;default:}}},this)})},this);if(!this.initQuota){this.initQuota=1;E()}if(!L.hasClass("noSend")){L.addClass("noSend");I()}},cancelUpdateEmail:function(F){F.preventDefault();var D=$("#popEnterNewEmail");D.hidePopup();var E=D.find(".resend");var G=E.attr("title");E.removeClass("noSend").text(G);this.emailSendTimes=0;clearInterval(this.timer)},onEnterNewEmail:function(H){var D=$("#popEnterNewEmail");var G=D.find(".binding");G.find(".err_tip").hideError();var E=G.find(".new_email").val();if(!E){G.find(".empty_email").showError();G.find(".new_email").parent().addClass("error_bg");if(H){H.preventDefault()}return false}if(!/^[\w.\-]+@(?:[a-z0-9]+(?:-[a-z0-9]+)*\.)+[a-z]{2,6}$/.test(E)){G.find(".wng_fmt").showError();G.find(".new_email").parent().addClass("error_bg");if(H){H.preventDefault()}return false}var F=$.trim(D.find(".capt_box").val());if(!F){G.find(".empty_capt").showError();D.find(".capt_box").parent().addClass("error_bg");if(H){H.preventDefault()}return false}this.checkNewEmail(function(){var I=D.find(".verify");I.find(".disten30x103 h6 em").text(" "+E+" ");$("#popEnterNewEmail .verify .resend").click()});if(H){H.preventDefault()}return false},updatePhone:function(){},editMibaoQuestions:function(){},updateMibaoQuestions:function(){},enableToken:function(){},disableToken:function(){}});var x=l.$class({constructor:function(D){D=D||{};profilesgp=D.sgp},syncHash:function(){var E=k.parse(location.hash);var F=location.hash;if(F===b){return}var D=E.service||"";b=F;switch(D){case"switchRegion":d("switchRegion");$("#switchRegion").click();break;default:$("#popSwitchRegion").hidePopup()}},uploadingPhoto:false,render:function(){$(document.body).delegate(".mod_acc_tip .btn_mod_close, .btn_back","click",l.proxy(function(ap){ap.preventDefault();var an=$(ap.target),ar=ap.target.id,aq=an.closest(".mod_acc_tip"),ao=aq.attr("id");switch(ar){case"reuploadPhoto":$("#photoUploader")[0].reset();$($(".layeruploadface .mod_tip_bd").hide()[0]).showPopup();$(".uploadimgs img").removeAttr("style").removeAttr("src");break;case"abortUpload":this.uploadingPhoto=false;$(ap.target).closest(".mod_acc_tip").hidePopup();$(".naImgLink a").click();$("#uploadPhoto").attr("src","about:blank");$(".uploadimgs img").removeAttr("style").removeAttr("src");break;default:$(ap.target).closest(".mod_acc_tip").hidePopup()}},this));$(".main_l").click(function(an){an.preventDefault();an.stopPropagation();if(JSP_VAR.deviceType!=="mobile"){return}$(an.currentTarget).find(".naImgLink a").click()});var D=2013;var U='<div class="select_panel select-year-panel">';for(var ai=D;ai>=1900;ai--){U+='<p value="'+ai+'">'+ai+"</p>"}U+="</div>";$(".select-year").prepend(U);var ah=$(".select-year-panel");var G=new Date().getFullYear();var R="";if(ah.length&&G>D){for(var ai=G;ai>D;ai--){R+='<p value="'+ai+'">'+ai+"</p>"}ah.prepend(R)}$(".birth-box .btn-cancel").bind("click",function(an){an.stopPropagation();$(this).closest(".tits_list").hide()});$(".titsbirth").bind("click",function(an){an.stopPropagation();$(an.target).closest("li").find(".tits_list").toggle()});$(document.body).click(function(an){$(".tits_list").hide()});$(".birth-box").delegate(".tits_list","click",function(an){an.stopPropagation()});$(".birth-box").delegate(".tits_list p","click",function(aq){var an=$(aq.target);var ao=an.closest("li");var ap=an.attr("value");if(ao.hasClass("biry")){W(ap)}else{if(ao.hasClass("birm")){al(ap)}else{Q(ap)}}an.closest(".tits_list").hide();$(".layereditinfo ul").trigger("birthChange")});$(".layereditinfo ul").bind("birthChange",function(){$(".layereditinfo .error-birth").hideError()});$(".infosex span").click(function(ap){var an=$(ap.target);var ao=an.closest(".infosex");ao.find("span").removeClass("now");an.closest("span",true).addClass("now")});function V(an){if(an===""){$(".infosex span").removeClass("now")}$(".infosex span").removeClass("now");if(isNaN(an)){$(".infosex em:contains("+an+")").closest("span").addClass("now")}else{$($(".infosex span")[an]).addClass("now")}}function O(an){an=+an;return(an%100!==0&&an%4===0)||(an%100===0&&an%400===0)}function af(ap,aq,ao){ap=parseInt(ap,10);aq=parseInt(aq,10);ao=parseInt(ao,10);var an=O(ap);var ar=F.concat([]);if(an){ar[2]=29}if(ao<=ar[aq]){return true}else{return false}}var F=[0,31,28,31,30,31,30,31,31,30,31,30,31];var ad=new Date,am=ad.getFullYear(),E=ad.getMonth()+1,ab=ad.getDate();function W(ap){if(!ap){$(".biry .birthcon").text(MSG.year);return}$(".biry .birthcon").text(ap);if(ap==am){$(".birm .tits_list p").each(function(ar,at){var au=parseInt(at.getAttribute("value"),10);if(au<=E){$(at).show()}else{$(at).hide()}})}else{$(".birm .tits_list p").show()}var ao=$(".biry .birthcon").text(),aq=$(".birm .birthcon").text(),an=$(".bird .birthcon").text();if(isNaN(ao)||isNaN(aq)||isNaN(an)){return}if(!af(ao,aq,an)){$(".bird .birthcon").text(MSG.date)}al(aq)}function al(ap){if(!ap){$(".birm .birthcon").text(MSG.month);return}$(".birm .birthcon").text(ap);ap=parseInt(ap,10);var ar=F[ap];if(O($(".biry .birthcon").text())&&ap===2){ar=29}$(".bird .tits_list p").each(function(at,au){if(at<ar){$(au).show()}else{$(au).hide()}});if($(".biry .birthcon").text()==am&&parseInt($(".birm .birthcon").text())===E){$(".bird .tits_list p").each(function(au,av){var at=parseInt(av.getAttribute("value"),10);if(at<=ab){$(av).show()}else{$(av).hide()}})}else{}var ao=$(".biry .birthcon").text(),aq=$(".birm .birthcon").text(),an=$(".bird .birthcon").text();if(isNaN(ao)||isNaN(aq)||isNaN(an)){return}if(!af(ao,aq,an)){$(".bird .birthcon").text(MSG.date)}else{Q(an)}}function Q(an){if(!an){$(".bird .birthcon").text(MSG.date);return}$(".bird .birthcon").text(an)}$(".country-container-panel").each(function(ao,ap){var an=$("<div>").addClass("country-container");an.html(RegionsCode.getAll({usual:"常用"},true));$(ap).append(an)});$("#popSwitchRegion .country-container").delegate(".record","click",function(aq){var an=$(aq.target),ar=an.closest(".listwrap").find("tt");var ap=an.closest(".record");var ao=ap.find(".record-country");ar.text(ao.text()).attr("_code",ao.data("brief"));an.closest(".country-container").hide();aq.preventDefault()});$("#continueSwitch").click(function(ao){ao.preventDefault();var an=$("#popSwitchRegion > .mod_tip_bd");$(an[0]).hide();$(an[1]).show()});$(document.body).click(function(an){$(".country-container").hide()});$(".country-container-panel .btn-cancel").bind("click",function(an){an.stopPropagation();$(this).closest(".country-container").hide()});$(".country-container-panel .country-container").bind("click",function(an){an.stopPropagation()});$("#popSwitchRegion .listtit").click(function(an){an.stopPropagation();$("#popSwitchRegion .country-container").toggle()});$("#doRegionSwitch").click(function(an){an.preventDefault();if(!C()){return}$("#popSwitchRegion .err_tip").hideError();if(!$("#popSwitchRegion .listtit tt").attr("_code")){$("#popSwitchRegion .empty_region").showError();return}if(!C()){return}$.ajax({url:"/pass/auth/profile/userRegion",type:"POST",dataType:"text",data:{userId:$(".na-num").text(),region:$("#popSwitchRegion .listtit tt").attr("_code"),passport_ph:n.get("passport_ph")||"",usercenter_ph:n.get("usercenter_ph")||"",passportsecurity_ph:n.get("passportsecurity_ph")||"",passToken:n.get("passToken")||""},error:y,success:function(ao){ao=ao.replace("&&&START&&&","");ao=$.parseJSONSafe(ao);if(ao.result===0){$("#popSwitchRegion").hidePopup();location.reload(true)}else{switch(ao.result){case 5200526:case 5200527:$("#popSwitchRegion .sys_err").showError(ao.result);break;case 1200525:$("#popSwitchRegion .bad_param").showError(ao.result);break;default:$("#popSwitchRegion .sys_err").showError(ao.result)}}}})});$("#switchRegion").click(function(ar){ar.preventDefault();if(!C()){return}var ap=$("#popSwitchRegion > .mod_tip_bd");$("#popSwitchRegion .err_tip").hideError();$(ap[0]).show();$(ap[1]).hide();var aq=$("#region");var an=aq.attr("_code")||"";var au=$('#popSwitchRegion .country-container .record-country[data-brief="'+an+'"]')[0];au=$(au);if(au.length){var ao=$.trim(au.data("brief")),at=$.trim(au.text());$("#popSwitchRegion .listtit tt").attr("_code",ao).text(at)}$("#popSwitchRegion").showPopup()});(function(){var ao=$("#region");var an=ao.attr("_code")||"";var aq=$('#popSwitchRegion .country-container .record-country[data-brief="'+an+'"]')[0];aq=$(aq);if(aq.length){var ap=$.trim(aq.text());ao.text(ap)}})();$("#editInfo, #editInfoWap").click(function(au){au.preventDefault();if(!C()){return}var an=$(".layereditinfo");an.find(".err_tip").hideError();var ao=$(".uinfo");var aq=$.trim(ao.find(".lblnickname .value").text());if(ao.find(".lblnickname .value").attr("_empty")!==undefined){aq=""}$("input[name=nickname]").val(aq);var ay=$.trim(ao.find(".lblbirthday .value").text());if(ao.find(".lblbirthday .value").attr("_empty")!==undefined){ay=""}if(/\d+\/\d+\/\d+/.test(ay)){var aw=ay.split("/");aw.reverse();ay=aw.join("-")}var ar=ay.split("-"),av=ar[0],at=ar[1],ap=ar[2];W(av);al(at);Q(ap);var ax=$.trim(ao.find(".lblgender .value").text());if(ao.find(".lblgender .value").attr("_empty")!==undefined){ax=""}V(ax);an.showPopup()});$(".layereditinfo .nickname").on("focus click",function(an){$(".layereditinfo .err_tip").hideError()});function ag(an){an=""+an;if(an.length===1){an="0"+an}return an}$(".layereditinfo .btn_commom").click(function(av){av.preventDefault();if(!C()){return}var an=$.trim($(".layereditinfo .nickname").val());var at="";var aq=parseInt($(".layereditinfo .biry .birthcon").text(),10),au=parseInt($(".layereditinfo .birm .birthcon").text(),10),ao=parseInt($(".layereditinfo .bird .birthcon").text(),10);var ar;var ap=new Date().setFullYear(am-13);if(!an){$(".layereditinfo .empty_name").showError();$(".layereditinfo .nickname").parent().addClass("err_label");return}if(an.length<2||an.length>20){$(".layereditinfo .bad_nickname").showError();$(".layereditinfo .nickname").parent().addClass("err_label");return}if(/[\/<>\%]+/.test(an)){$(".layereditinfo .mismatch_nickname").showError();$(".layereditinfo .nickname").parent().addClass("err_label");return}if(!aq&&!au&&!ao){at=""}else{if((aq||au||ao)&&(!aq||!au||!ao)){$(".layereditinfo .empty_birthday").showError();return}else{if(ap-new Date().setFullYear(aq)<0&&profilesgp){$(".layereditinfo .invalid_birthday").showError();return}else{at=[aq,ag(au),ag(ao)].join("-")}}}ar=32-(new Date(aq,au-1,32)).getDate();if(ao>ar){$(".bird .birthcon").text(MSG.date)}if(!C()){return}$.ajax({type:"POST",dataType:"text",url:"/pass/auth/profile/userProfile",data:{nickname:an,birthday:at,gender:$(".layereditinfo .infosex .now").attr("value")||"",userId:$(".na-num").text(),passport_ph:n.get("passport_ph")||"",usercenter_ph:n.get("usercenter_ph")||"",passportsecurity_ph:n.get("passportsecurity_ph")||"",passToken:n.get("passToken")||""},error:y,success:function(aw){aw=aw.replace("&&&START&&&","");aw=$.parseJSONSafe(aw);if(aw.result===0){$(".layereditinfo").hidePopup();location.reload(true)}else{$(".layereditinfo .err_tip").hideError();switch(aw.result){case 1200503:$(".layereditinfo .empty_param").showError(aw.result);break;case 1200504:$(".layereditinfo .bad_nickname").showError(aw.result);break;case 1200511:$(".layereditinfo .mismatch_nickname").showError(aw.result);break;case 1200505:$(".layereditinfo .bad_birthday").showError(aw.result);break;case 1200506:$(".layereditinfo .bad_gender").showError(aw.result);break;case 1200507:$(".layereditinfo .bad_param").showError(aw.result);break;case 1200508:case 5200509:case 5200510:case 5000000:$(".layereditinfo .sys_err").showError(aw.result);break;default:}}}})});$(".uplodefile").change(l.proxy(function(av){if(!C()){return}$(".layeruploadface").find(".err_tip").hide();var at=av.target.files;if(at&&at.length){var ap=at[0];if(ap.size>1<<21){$(".layeruploadface .file_too_large").showError();return}}var ao=av.target.value,ar=av.target.form,an=$(ar);if(ao){var au=ao.lastIndexOf(".");if(au!==-1){var aq=ao.substring(au+1).toLowerCase();if(aq!=="png"&&aq!=="jpg"){$(".layeruploadface .wng_fmt").showError();return}}}else{return}$(".layeruploadface .err_tip").hideError();this.uploadingPhoto=true;if(!C()){return}$.ajax({type:"POST",url:"/pass/auth/profile/requestUpload",dataType:"text",data:{userId:$(".na-num").text(),passport_ph:n.get("passport_ph")||"",usercenter_ph:n.get("usercenter_ph")||"",passportsecurity_ph:n.get("passportsecurity_ph")||"",passToken:n.get("passToken")||"",quality:"1.0",isRedirect:"true"},error:y,success:l.proxy(function(aw){aw=aw.replace("&&&START&&&","");aw=$.parseJSONSafe(aw);if(aw.result===0){$(".layeruploadface .preupload").hide();$(".layeruploadface .uploading .err_tip").hideError();$(".layeruploadface .uploading").show();var ax=aw.info.tempUploadUrl;ar.action=ax;an.submit()}else{switch(aw.result){case 5200512:case 5200513:case 5000000:$(".layeruploadface .preupload .sys_err").showError(aw.result);break;default:}}},this)})},this));$(".naImgLink a, .na-edit").click(function(an){an.stopPropagation();an.preventDefault();if(!C()){return}var ao=$(".layeruploadface");ao.find(".err_tip").hideError();ao.find("form").trigger("reset");$(ao.find(".mod_tip_bd").hide()[0]).show();ao.showPopup()});var P=100;$(".layeruploadface .uploaded .clipimg img").load(l.proxy(function(ar){if(!this.uploadingPhoto){return}var ap=$(ar.target),ao=$(".layeruploadface .uploaded .movebox"),aq=ap.parent();$(".layeruploadface .uploading").hide();$(".layeruploadface .uploaded .err_tip").hideError();$(".layeruploadface .uploaded").show();$("#img_cache").append(ap);var an=ap.width();imgHeight=ap.height();var au=Math.min(300,$(".layeruploadface .uploaded .clipimg").width());if(an>imgHeight){if(an>au){imgHeight=Math.floor(imgHeight*au/an);an=au}}else{if(imgHeight>au){an=Math.floor(an*au/imgHeight);imgHeight=au}}ap.css({width:an+"px",height:imgHeight+"px"}).appendTo(aq);$("#img_cache").html("");P=Math.min(100,Math.min(ap.width(),ap.height()));ap.css("top",Math.floor((au-ap.prop("offsetHeight"))/2));ap.css("left",Math.floor((au-ap.prop("offsetWidth"))/2));var at=Math.floor((au-P)/2);ao[0].style.cssText="width:"+P+"px;height:"+P+"px;top:"+at+"px;left:"+at+"px;";this.uploadingPhoto=false},this));$(".layeruploadface .btn_mod_close").bind("click",function(an){an.preventDefault();an.stopPropagation();$(".clipimg .uploadimgs img").removeAttr("style").attr("src","");$(an.target).closest(".mod_acc_tip").hidePopup()});var I=$("#uploadPhoto"),ae=I[0];var N="";function H(ao){var an=$("<DIV/>").html(ao);var ap=an.text();an=null;return ap}function ak(ar){if(ae.readyState==="complete"||ae.readyState==="loaded"||(ar&&ar.type==="load")){N="";var aq;try{aq=ae.contentDocument||(ae.contentWindow&&ae.contentWindow.document)||ae.document;if(!aq){return}}catch(ao){return}var at=H($(aq).find("textarea.jsonResult").val());var ap=at;ap=ap.replace("&&&START&&&","");ap=$.parseJSONSafe(ap);if(!ap){$(".layeruploadface .uploading .sys_err").showError();return}if(ap.result===0){N=H($(aq).find("textarea.uploadResult").val());var an=ap.info.data.temp_url;$(".layeruploadface .uploaded .clipimg img").attr("src",an)}else{if(ap.result===1200521){if(ap.info){ap.result=ap.info.issErrorCode}}switch(ap.result){case 90021:$(".layeruploadface .uploading .file_too_large").showError(ap.result);break;case 90018:$(".layeruploadface .uploading .wng_fmt").showError(ap.result);break;case 5200522:case 5200524:case 5000000:$(".layeruploadface .uploading .sys_err").showError(ap.result);break;case 1200523:$(".layeruploadface .uploading .missing_param").showError(ap.result);break;case 80017:$(".layeruploadface .uploading .missing_file").showError(ap.result);break;case 10007:$(".layeruploadface .uploading .unsupported_mime_type").showError(ap.result);break;default:}}}}if("onreadystatechange" in ae){ae.onreadystatechange=ak}else{ae.onload=ak}var L=false;var aa,Z;var K=$(".movebox"),aj=K[0];var X=$(".uploadimgs img");function ac(an){if(an.type.indexOf("touch")>-1){if(an.originalEvent.touches&&an.originalEvent.touches.length){return{pageX:an.originalEvent.touches[0].pageX,pageY:an.originalEvent.touches[0].pageY}}}else{return{pageX:an.pageX,pageY:an.pageY}}}K.bind("mousedown touchstart",function(ao){ao.preventDefault();ao.stopPropagation();L=true;var an=ac(ao);aa=an.pageX-parseInt(K.css("left"));Z=an.pageY-parseInt(K.css("top"))});$(document).bind("mousemove touchmove",function(aq){if(L){aq.preventDefault();aq.stopPropagation();if(JSP_VAR.deviceType==="mobile"&&aq.target!==aj){L=false;return}var ap=parseInt(X.css("left"),10),aw=ap+X.prop("offsetWidth")-K.prop("offsetWidth");var av=parseInt(X.css("top"),10),an=av+X.prop("offsetHeight")-K.prop("offsetHeight");var ax=ac(aq);var au=ax.pageX-aa;var at=ax.pageY-Z;if(au<ap){au=ap}if(at<av){at=av}if(au>aw){au=aw}if(at>an){at=an}var ar=Math.round((au-ap)*100/(X.prop("offsetWidth")-K.prop("offsetWidth")))+"%";var ao=Math.round((at-av)*100/(X.prop("offsetHeight")-K.prop("offsetHeight")))+"%";K.css({top:at,left:au})}}).bind("mouseup _touchend",function(an){an.preventDefault();L=false});var S=$(".layeruploadface .icon_square_rightbot"),Y=S[0];var T,J,M=false;S.bind("mousedown touchstart",function(ao){ao.stopPropagation();ao.preventDefault();M=true;var an=ac(ao);T=an.pageX-parseInt(S.css("left"),10);J=an.pageY-parseInt(S.css("top"),10)});$(document).bind("mousemove touchmove",function(aq){if(M){aq.stopPropagation();aq.preventDefault();if(JSP_VAR.deviceType==="mobile"&&aq.target!==Y){M=false;return}var ax=ac(aq);var at=ax.pageX-T;var ar=ax.pageY-J;var ap=parseInt(X.css("left"),10),aw=ap+X.prop("offsetWidth")-parseInt(K.css("left"),10);var av=parseInt(X.css("top"),10),an=av+X.prop("offsetHeight")-parseInt(K.css("top"),10);var au=Math.max(at,ar);var ao=au;if(ao<P){ao=P}if(ao>aw){ao=aw}if(ao>an){ao=an}ao-=2;K.css({height:ao,width:ao})}}).bind("mouseup _touchend",function(an){if(M){M=false;an.stopPropagation();an.preventDefault()}});$(".layeruploadface .uploaded .btn_commom").click(function(an){an.preventDefault();if(!C()){return}$.ajax({url:"/pass/auth/profile/commitUpload",type:"POST",data:{userId:$(".na-num").text(),passport_ph:n.get("passport_ph")||"",usercenter_ph:n.get("usercenter_ph")||"",passportsecurity_ph:n.get("passportsecurity_ph")||"",passToken:n.get("passToken")||"",uploadResult:N,cropParam:(function(){var aq=parseInt(X.css("left"),10),at=X.prop("offsetWidth"),aw=K.prop("offsetWidth");var ax=parseInt(X.css("top"),10),au=X.prop("offsetHeight"),ay=K.prop("offsetHeight");var ap=parseInt(K.css("left"),10)-aq,av=parseInt(K.css("top"),10)-ax,ao=ap+aw,ar=av+ay;ap/=at;av/=au;ao/=at;ar/=au;if(ap<0){ap=0}if(ap>1){ap=1}if(av<0){av=0}if(av>1){av=1}if(ao<0){ao=0}if(ao>1){ao=1}if(ar<0){ar=0}if(ar>1){ar=1}return'{"x1":'+ap+',"y1":'+av+',"x2":'+ao+',"y2":'+ar+"}"})},dataType:"text",error:y,success:function(ao){ao=ao.replace("&&&START&&&","");ao=$.parseJSONSafe(ao);if(ao.result===0){$(".layeruploadface").showPopup();location.reload(true)}else{$(".layeruploadface .uploaded .err_tip").hideError();switch(ao.result){case 5200517:case 5200518:case 5200519:case 5200520:case 5000000:$(".layeruploadface .uploaded .sys_err").showError(ao.result);break;case 1200514:case 1200516:$(".layeruploadface .uploaded .bad_param").showError(ao.result);break;case 1200515:$(".layeruploadface .uploaded .upload_failed").showError(ao.result);break;default:}}}})});$(".layereditinfo .nickname").keypress(function(an){if(an.keyCode===13){an.preventDefault();$(".layereditinfo .btn_commom").click()}});this.syncHash();setInterval(l.proxy(function(){this.syncHash()},this),500)}});var g=l.$class({constructor:function(){},render:function(){this.uiBind()},uiBind:function(){},kick:function(){},onKick:function(){},requirePassword:function(){},untrust:function(){},onUntrust:function(){},findDevice:function(){},deleteRecord:function(){},editPassword:function(){}});var r=l.$class({constructor:function(){this.$bindingContainer=$("[_role=bindingContainer]");this.$a11nContainer=$("[_role=a11nContainer]")},render:function(){this.uiBind()},uiBind:function(){this.$bindingContainer.delegate("[_role=icon]","click",l.proxy(function(D){this.onClickBindingIcon($(D.target))},this));this.$a11nContainer.delegate("[_role=icon]","click",l.proxy(function(D){this.onClickA11NIcon($(D.target))},this))},onClickBindingIcon:function(E){var D=E.attr("_name");Util.showPopup(D)},onClickA11NIcon:function(E){var D=E.attr("_name");Util.showPopup(D)}});var a=l.$class({constructor:function(){},render:function(){this.uiBind()},uiBind:function(){}});var c=l.$class({constructor:function(){},showPopup:function(D){$(D).show()},hidePopup:function(D){$(D).hide()},fix:function(D){if($.browser.msie&&+$.browser.version<=6){D.css({position:"absolute"});var E=$(document);$win.bind("scroll resize",u.debounce(l.proxy(function(){D.css({top:E.scrollTop()+"px",left:E.scrollLeft()+"px"})},this),500))}}});var w=l.$class({constructor:function(D){D=D||{};this.sgp=D.sgp;this.phoneTip=new A(".phone_tip");this.phoneCaptTip=new A(".phone_capt_tip");this.smsTip=new A(".sms_tip");this.regTip=new A(".reg_tip");this.usageTip=new A(".usage_tip");this.photoTip=new A(".photo_tip");this.idTip=new A(".id_tip");this.passwordItemGroup=new i({max:3,parent:$("#passwords"),selector:".add_more",source:'<div class="add_more clearfix">'+$("#passwords .add_more").html()+"</div>",add:$("#passwords .add_more_link"),remove:$("#passwords .del_link")});this.emailItemGroup=new i({max:3,parent:$("#emails"),selector:".add_more",source:'<div class="add_more clearfix">'+$("#emails .add_more").html()+"</div>",add:$("#emails .add_more_link"),remove:$("#emails .del_link")});this.phoneItemGroup=new i({max:3,parent:$("#phones"),selector:".add_more",source:'<div class="add_more clearfix">'+$("#phones .add_more").html()+"</div>",add:$("#phones .add_more_link"),remove:$("#phones .del_link")});this.phoneModelItemGroup=new i({max:3,parent:$("#phone_models"),selector:".add_more",source:'<div class="add_more clearfix">'+$("#phone_models .add_more").html()+"</div>",add:$("#phone_models .add_more_link"),remove:$("#phone_models .del_link")});this.imeiItemGroup=new i({max:3,parent:$("#imeis"),selector:".add_more",source:'<div class="add_more clearfix">'+$("#imeis .add_more").html()+"</div>",add:$("#imeis .add_more_link"),remove:$("#imeis .del_link")});this.eshopInfoItemGroup=new i({max:3,parent:$("#eshop-info-inputs-group"),selector:".add_more",source:'<div class="add_more clearfix">'+$("#eshop-info-inputs-group .add_more").html()+"</div>",add:$("#eshop-info-inputs-group .add_more_link"),remove:$("#eshop-info-inputs-group .del_link")})},quotaCache:{},captchHide:false,submitLock:0,uiBind:function(){$(".country-container-panel").each(function(N,O){var M=$("<div>").addClass("country-container");M.html(RegionsCode.getAll({usual:"常用"},true));$(O).append(M)});$(".listtit").click(function(M){M.stopPropagation();$(".country-container").toggle()});$(document.body).click(function(M){$(".country-container").hide();D=false});$(".country-container-panel .btn-cancel").bind("click",function(M){M.stopPropagation();$(this).closest(".country-container").hide()});$(".country-container-panel .country-container").bind("click",function(M){M.stopPropagation()});$(".country-container").delegate(".record","click",function(R){R.stopPropagation();$(".country-container").hide();var S=$(R.target).closest(".record");var O=S.find(".record-country");var M=S.find(".record-code");var Q=$.trim(M.text()),N=$.trim(O.text()),P=O.data("code");$(".listtit").attr("_code",P).find("tt").html(N+"("+Q+")&lrm;")});$(".chkcode_img").click(function(N){N.stopPropagation();var M=N.target,O=M.getAttribute("_src");M.src=O+"&"+(+new Date);D=true});$("#phone").bind("focus click",l.proxy(function(M){this.phoneTip.hide();$("#appeal .shenhe_by_phone .phone_tip:not(.too_much)").hide();$(M.target).parent().removeClass("err_label")},this)).blur(l.proxy(function(N){this.phoneTip.hide();var M=$.trim(N.target.value);if(!M){this.phoneTip.show("empty_phone");$("#phone").parent().addClass("err_label")}else{if(!/^\d+$/.test(M)){this.phoneTip.show("wng_fmt");$("#phone").parent().addClass("err_label")}}},this));var D=false;$("#phone_capt").bind("focus click",l.proxy(function(M){this.phoneCaptTip.hide();$(M.target).parent().removeClass("err_label")},this)).blur(l.proxy(function(M){setTimeout(l.proxy(function(){if(D){return}this.phoneCaptTip.hide();var N=$.trim(M.target.value);if(!N){this.phoneCaptTip.show("empty_capt");$(M.target).parent().addClass("err_label")}},this),150)},this));$(".chkcode_img").click(function(M){$("#phone_capt").val("")});$("#resend").click(l.proxy(function(M){if($(M.target).hasClass("noSend")){return}sendResetTicket(true)},this));$(".resendcode").bind("focus click",l.proxy(function(M){this.smsTip.hide()},this)).blur(l.proxy(function(N){var M=$.trim($(".resendcode").val());if(!M){this.smsTip.show("empty_capt");$(".resendcode").parent().addClass("err_label")}},this));$("#validate").click(l.proxy(function(Q){var P=$(".listtit").attr("_code")||"";var M=$("#phone").val();var O=((P==="+86")?"":P)+M;var N=$.trim($(".resendcode").val());if(!N){this.smsTip.show("empty_capt");$(".resendcode").parent().addClass("err_label");return}$.ajax({url:"/pass/retrieve/verifyPhoneContactAddress",type:"POST",dataType:"text",data:{externalId:$("#externalId").val(),vkey:N,contactAddress:O},error:y,success:l.proxy(function(R){R=$.parseJSONSafe(R.replace("&&&START&&&",""));if(R.code===0){this.nextTabPanel();this.nextTabHeader()}else{switch(R.code){case 70008:this.smsTip.show("wng_fmt");break;case 20003:this.smsTip.show("not_exists");break;case 70014:this.smsTip.show("wng_capt");$(".resendcode").val("").parent().addClass("err_label");break;case 10001:case 5000000:this.smsTip.show("sys_err");$(".resendcode").val("").parent().addClass("err_label");break;default:}}},this)})},this));$("#back_to_sms").click(l.proxy(function(M){M.preventDefault();if(this.smsTimer){this.smsTimer.stop()}var N=$("#resend").attr("_text");if(N){$("#resend").text(N)}setTimeout(l.proxy(function(){this.phoneCaptTip.hide();$("#phone_capt").parent().removeClass("err_label");this.changeToPanel("bind")},this),100)},this));var H=this.quotaCache;var L=$("#submitPhone");L.click(l.proxy(function(S){S.preventDefault();console.log(this.submitLock);console.log("line");if(this.submitLock){return false}console.log(this.submitLock+"a1");if(L.hasClass("disabled")){return false}this.phoneTip.hide();var M=$("#prefix").attr("_code")||"+86";var Q=f(M);var T=$.trim($("#phone").val());if(!T){this.phoneTip.show("empty_phone");$("#phone").parent().addClass("err_label");return}else{if(!RegExp(Q).test(T)){this.phoneTip.show("wng_fmt");$("#phone").parent().addClass("err_label");return}}this.phoneCaptTip.hide();this.smsTip.hide();$(".resendcode").parent().removeClass("err_label");var O=$.trim($("#phone_capt").val());if(!O){this.phoneCaptTip.show("empty_capt");$("#phone_capt").parent().addClass("err_label");return}var R=$(".listtit").attr("_code")||"",V=$("#phone").val();if(R==="+86"){R=""}var P=R+V;var U;if(!R){U="+86 "+V}else{U=R+" "+V}this.submitLock=1;console.log(this.submitLock+"a2");if(H.hasOwnProperty(P)){var N=H[P];if(N===0){this.showLeftTimes(N,false,false)}else{this.checkNewPhoneBindStatus(P)}}else{this.checkQuota(P,l.proxy(function(W){if(W===0){this.showLeftTimes(W,false,false)}else{this.checkNewPhoneBindStatus(P)}},this))}},this));var F=$(".con-shenhe");var K=F.find(".bind-info-panel");K.find("a[data-action]").bind("click",l.proxy(function(N){N.stopPropagation();var M=$(N.target).data("action");if(M==="ok"){console.log(this.submitLock+"a6");if(this.submitLock){return}this.submitLock=1;console.log(this.submitLock+"a5");this.checkNewRetrievePhone(true)}else{if(M==="back"){this.phoneCaptTip.hide();$("#phone_capt").parent().removeClass("err_label");this.changeToPanel("bind")}}},this));$("#serviceUsed-dom .checkbox_container").click(function(M){$(M.target).closest(".checkbox_container").toggleClass("now")});var J=$("#devices");var E=$("#var_btn");$("#devices .othway").click(function(N){$(N.currentTarget).toggleClass("now");var M=$(this).parents(".halfcon").find(".comfill_con");if($(this).hasClass("now")){M.data("disable-add","1");J.find(".labelbox").addClass("input_disabled").find("input").attr("disabled","true").val("");J.find(".un_provide_area").removeClass("now").addClass("cursor_d").data("disable-click",1);J.find(".icon_add_del").addClass("cursor_d");E.removeClass("disabled")}else{M.data("disable-add","0");J.find(".labelbox").removeClass("input_disabled").find("input").removeAttr("disabled","true");J.find(".un_provide_area").removeClass("cursor_d").data("disable-click",0);J.find(".icon_add_del").removeClass("cursor_d");E.addClass("disabled")}});$("#YearLocation-dom .del_link").click(function(P){var N=$("#YearLocation-dom");var O=N.find(".areapick_container .areapicker");var M=O.length;if(M>1){$(O[M-1]).remove()}M--;if(M<2){$(P.target).hide()}$("#YearLocation-dom .add_more_link").show()});$("#YearLocation-dom .add_more_link").click(function(R){var N=$("#YearLocation-dom");var Q=N.find(".areapick_container");var P=$('<div class="areapicker c_b"/>').html(Q.find(".areapicker-tmpl").html()).appendTo(Q);selectArea(P);$("#YearLocation-dom .del_link").show();var O=N.find(".areapick_container .areapicker");var M=O.length;if(M>=3){$(R.target).hide()}$("#YearLocation-dom .i_selectoption > dd:first-child").hide()});$("#reg_by").change(l.proxy(function(N){var M=+N.target.value;switch(M){case -1:case 1:$("#reg_via").parent().show();$("#reg_via2").parent().hide();$("#reg_via3").parent().hide();break;case 2:$("#reg_via2").parent().show();$("#reg_via3").parent().hide();$("#reg_via").parent().hide();break;case 0:$("#reg_via3").parent().show();$("#reg_via").parent().hide();$("#reg_via2").parent().hide();break;default:}$("#registerWay-dom .reg_by").hide();if(M!==-1){this.regTip.hide("reg_by")}},this));$("#reg_via, #reg_via2, #reg_via3").change(l.proxy(function(N){$("#registerWay-dom .reg_via").hide();var M=+N.target.value;if(M!==-1){this.regTip.hide("reg_via")}},this));$("#submit_reg").click(l.proxy(function(P){this.regTip.hide();var M=+$("#reg_by").val();if(M===-1){this.regTip.show("reg_by");return}var O;if(M===1){O=+$("#reg_via").val()}else{if(M===2){O=+$("#reg_via2").val()}else{O=+$("#reg_via3").val()}}if(O===-1){this.regTip.show("reg_via");return}var Q=false;$(".areapicker").each(function(U,ab){var Z=$(ab);var V=Z.find(".year"),X=Z.find(".country"),aa=Z.find(".province"),S=Z.find(".city");var R=V.prop("selectedIndex"),W=X.prop("selectedIndex"),Y=aa.prop("selectedIndex"),T=S.prop("selectedIndex");if(R&&W){Q=true;return false}});if(!Q){this.regTip.show("area");return}var N=!!($(".checkbox_container.now").length||$(".checkbox_more label input").val());if(!N){this.regTip.show("service");return}this.nextTabHeader();this.nextTabPanel()},this));E.click(l.proxy(function(N){var O=$(N.currentTarget);if(O.hasClass("disabled")){return}if($("#devices .othway").hasClass("now")){this.nextTabPanel();$("#imeis .input_kuang").each(function(P,Q){if(!/^\d*$/.test(Q.value)){Q.value=""}});return}this.usageTip.hide();$("#phone_models .labelbox, #imeis .labelbox").removeClass("err_label");var M=false;$("#imeis .input_kuang").each(function(P,Q){var R=$.trim(Q.value);if(R&&!/^\d+$/.test(R)){M=true;$(Q).parent().addClass("err_label");return false}});if(M){this.usageTip.show("wng_imei_fmt");return}this.nextTabPanel()},this));$("#usage_btn").click(l.proxy(function(P){if($(P.target).hasClass("disabled")){return false}P.preventDefault();this.usageTip.hide();this.regTip.hide();var R=true,O=true,Q=true;$(".areapicker").each(function(V,ac){var aa=$(ac);var W=aa.find(".year"),Y=aa.find(".country"),ab=aa.find(".province"),T=aa.find(".city");var S=W.prop("selectedIndex"),X=Y.prop("selectedIndex"),Z=ab.prop("selectedIndex"),U=T.prop("selectedIndex");if(!S){O=false}if(!X){Q=false}if(!(S&&X)){R=false;return false}});if(!O){this.regTip.show("year");return false}if(!Q){this.regTip.show("locale");return false}if(!R){this.regTip.show("area");return}var N=this;$("#passwords .labelbox, #emails .labelbox, #phones .labelbox").removeClass("err_label").delegate(".input_kuang","focus",function(){N.usageTip.hide()});var M=false;if(!$("#passwords .un_provide_area").hasClass("now")){$("#passwords .input_kuang").each(function(S,T){var U=$.trim(T.value);if(!U){M=true;$(T).parent().addClass("err_label");N.usageTip.show("empty-pwd-value")}});if(M){return}}if(!$("#emails .un_provide_area").hasClass("now")){$("#emails .input_kuang").each(function(S,T){var U=$.trim(T.value);if(!U){M=true;$(T).parent().addClass("err_label");N.usageTip.show("empty-email-value")}else{if(U&&!/^[\w.\-]+@(?:[a-z0-9]+(?:-[a-z0-9]+)*\.)+[a-z]{2,6}$/.test(U)){M=true;$(T).parent().addClass("err_label");N.usageTip.show("wng_email_fmt")}}});if(M){return}}if(!$("#phones .un_provide_area").hasClass("now")){$("#phones .input_kuang").each(function(S,T){var U=$.trim(T.value);if(!U){M=true;$(T).parent().addClass("err_label");N.usageTip.show("empty-phone-value")}else{if(U&&!/^\+?\d+$/.test(U)){M=true;$(T).parent().addClass("err_label");N.usageTip.show("wng_phone_fmt");return false}}});if(M){return}}$(this).trigger("panelSubmit")},this));$("#id_type").change(l.proxy(function(N){var M=+N.target.value;if(M){this.idTip.hide("empty_id_type")}},this));$("#final_btn").click(l.proxy(function(M){this.idTip.hide();if(!+$("#id_type").val()){this.idTip.show("empty_id_type");return}if(!$("#name_value").val()){this.idTip.show("empty_name_value");return}if(!$("#id_value").val()){this.idTip.show("empty_id_value");return}if(!$("#photoId").val()){this.idTip.show("empty_id_photo");return}this.submit()},this));$("#emails").delegate(".err_label","click focus",l.proxy(function(M){$(".wng_email_fmt").hide()},this));$("#phones").delegate(".err_label","click focus",l.proxy(function(M){$(".wng_phone_fmt").hide()},this));$("#imeis").delegate(".err_label","click focus",l.proxy(function(M){$(".wng_imei_fmt").hide()},this));$(document.body).delegate(".err_label","click focus",function(M){$(M.target).closest(".err_label").removeClass("err_label")});var G=this;window.uploadSuccess=function(){var P=window.frames&&window.frames.uploadIframe;if(!P||!P.data){return}var O=P.data;var N=O.tempId;var Q=O.data;if(N!=$("#imgId").val()){return}clearTimeout(G.uploadTimeout);$("#timeout_mes").hide();$("#loading").hide();$("#photoId").val(Q.mfsFileId);if(!Q.success){switch(Q.errorCode){case 20003:G.photoTip.show("not_exists");break;case 20005:G.photoTip.show("wng_fmt");break;case 10012:case 10001:G.photoTip.show("sys_err");break;case 80004:G.photoTip.show("file_too_large");break;default:G.photoTip.show("error")}}else{G.photoTip.hide();$("#img_area").attr("src","/pass/retrieve/photo/download?externalId="+encodeURIComponent($("#externalId").val())+"&mfsFileId="+Q.mfsFileId+"&photoKey="+Q.authkey);var M=$("#fileUpload");var R=M.attr("_retext");$("#fileButton").text(R)}};$("#img_area").bind("load error",function(M){$("#img_area").show()});$("#fileUpload").change(l.proxy(function(T){var N=T.target,Q=N.form,R=N.value;if(R){var S=R.lastIndexOf(".");if(S!==-1){var O=R.substring(S+1).toLowerCase();if(O!=="png"&&O!=="jpg"){G.photoTip.show("wng_fmt");$("#img_area").hide();return}}var P=N.files;if(P&&P.length){var M=P[0];if(M.size>5<<20){G.photoTip.show("file_too_large");$("#img_area").hide();return}}$("#imgId").val(+new Date);$(Q).trigger("submit");$("#loading").show();$("#img_area").hide();$("#timeout_mes").hide();$("#error_mes").hide();this.uploadTimeout=setTimeout(l.proxy(function(){$("#loading").hide();$("#imgId").val(+new Date);$("#timeout_mes").show()},this),60000)}},this));$("#phone, #phone_capt").bind("keypress",function(M){if(M.keyCode===13){$("#submitPhone").click()}});$(".resendcode").bind("keypress",function(M){if(M.keyCode===13){$("#validate").click()}});$('input[name="moreServices"]').bind("keypress",function(M){if(M.keyCode===13){$("#submit_reg").click()}});$(document.body).delegate('input[name="passwordUsed"], input[name="bindEmailUsed"], input[name="bindPhoneUsed"], input[name="mobilePhoneModel"], input[name="androidPhoneIMEI"], input[name="iphoneWIFI"]',"keypress",function(M){if(M.keyCode===13){$("#var_btn").click()}});$("#id_value").bind("keypress",function(M){if(M.keyCode===13){$("#final_btn").click()}});$("#reg_by + .i_selectbox .i_currentselected").click(function(){$(".regVia .i_selectoption, #YearLocation-dom .i_selectoption").hide()});$(".regVia .i_currentselected").click(function(){$("#reg_by + .i_selectbox .i_selectoption, #YearLocation-dom .i_selectoption").hide()});$("#YearLocation-dom").delegate(".i_currentselected","click",function(M){$("#registerType-dom .i_selectoption, #registerWay-dom .i_selectoption").hide()});var I=document.getElementById("imeis");setInterval(function(){var N=I.getElementsByTagName("input");for(var P=0,M=N.length;P<M;P++){var O=N[P];O.value=O.value.replace(/\D/g,"")}N=null},500)},isPhoneNumber:function(D){if(/^\d{6,}$/.test(D)||/^\+\d{6,}$/.test(D)||/^0{2}\d{6,}$/.test(D)){return true}return false},showLeftTimes:function(F,H,G){var E=$("#appeal .shenhe_by_phone .too_much");var D=$("#quotaLabel");if(F>0){E.hide()}else{E.show();this.submitLock=0;console.log(this.submitLock+"left")}if(F<=2){D.text(Math.max(0,F)).parent().show()}else{D.text(0).parent().hide()}},checkQuota:function(F,D){var E=this.quotaCache;$.ajax({data:{address:F,contentType:4000004,userId:JSP_VAR.userId},type:"POST",url:"/pass/sms/quota",dataType:"text",success:function(G){G=$.parseJSONSafe(G.replace("&&&START&&&",""));if(G.result===0){E[F]=parseInt(G.info);D&&D(parseInt(G.info))}else{D&&D(0)}},error:function(){D&&D(0)}})},checkNewPhoneBindStatus:function(F){var D=$(".shenhe_by_phone");var G=this.quotaCache[F];var E={externalId:$("#externalId").val(),contactAddress:F,icode:$("#phone_capt").val()};if(this.captchHide===true){delete E.icode}$.ajax({url:"/pass/retrieve/checkManualUserBindInfo",type:"POST",dataType:"text",data:E,success:l.proxy(function(H){this.submitLock=0;console.log(this.submitLock+"a7");H=$.parseJSONSafe(H.replace("&&&START&&&",""));if(H.code===0){var H=H.data;if(H.times===0){D.find(".binding_left_times").showError();D.find("#phone").parent().addClass("err_label")}else{if(H&&H.userId&&/\*+/.test(H.userId)){console.log(this.submitLock+"a4");$(".bind-tip .bind-time").text(H.ts);$(".bind-tip .bind-id").text(H.userId);this.changeToPanel("bindTip")}else{this.checkNewRetrievePhone()}}}else{if(H.code===87001){$(".chkcode_img").click();$("#phone_capt").parent().addClass("err_label");D.find(".wng_capt").showError()}else{if(H.code===70008){$("#phone").parent().addClass("err_label");D.find(".wng_fmt").showError()}else{if(H.code===20031){$(".shenhe_by_phone .inputcode").show();this.captchHide=false;$(".chkcode_img").click();$("#phone_capt").parent().addClass("err_label");D.find(".empty_capt").showError()}else{D.find(".sys_err").showError()}}}}},this)})},checkNewRetrievePhone:function(K){var F=60000,D=60000;var I=this.quotaCache;var G=$("#prefix").attr("_code")||"";if(G==="+86"){G=""}var J=$("#phone").val();var E=G+J;var L;if(!G){L="+86 "+J}else{L=G+" "+J}var H=window.sendResetTicket=l.proxy(function(N){var M={externalId:$("#externalId").val(),contactAddress:E};$.ajax({type:"POST",dataType:"text",url:"/pass/retrieve/phoneContactAddressConfirmMessage",data:M,error:y,success:l.proxy(function(O){this.submitLock=0;console.log(this.submitLock+"a3");O=$.parseJSONSafe(O.replace("&&&START&&&",""));this.phoneCaptTip.hide();this.phoneTip.hide();$("#phone").parent().removeClass("err_label");$("#phone_capt").parent().removeClass("err_label");switch(O.code){case 0:$(".shenhe_by_phone .inputcode").hide();this.captchHide=true;$("#full_phone").val(E);$(".regbox .step2 em").text(L);var R=$(".regbox .step2 #resend"),Q=R.attr("_text");R.addClass("noSend");var P=this.smsTimer=new u.Countdown({duration:D,onProgress:function(S){R.text(Q+"("+Math.round(S.timeLeft/1000)+")")},onComplete:function(){R.text(Q);if(I[E]>0){R.removeClass("noSend")}}});D+=F;P.start();$(".resendcode").val();I[E]--;if(!N){this.changeToPanel("sendTicket")}this.showLeftTimes(I[E],N,false);break;case 70021:this.phoneTip.show("mibao");$("#phone").parent().addClass("err_label");$(".chkcode_img").click();break;case 70013:this.phoneTip.show("bound");$("#phone").val("").parent().addClass("err_label");$(".chkcode_img").click();break;case 20003:this.phoneTip.show("not_exists");$("#phone").val("").parent().addClass("err_label");$(".chkcode_img").click();break;case 20031:$(".shenhe_by_phone .inputcode").show();this.captchHide=false;this.phoneCaptTip.show("empty_capt");$("#phone_capt").parent().addClass("err_label");$(".chkcode_img").click();this.changeToPanel("bind");break;case 20023:this.phoneTip.show("too_many");$("#phone").val("").parent().addClass("err_label");$(".chkcode_img").click();break;case 87001:$(".shenhe_by_phone .inputcode").show();this.captchHide=false;this.phoneCaptTip.show("wng_capt");$("#phone_capt").parent().addClass("err_label");$(".chkcode_img").click();this.changeToPanel("bind");break;case 70008:this.phoneTip.show("wng_fmt");$("#phone").val("").parent().addClass("err_label");$(".chkcode_img").click();break;case 70022:this.phoneTip.show("send_fail");$("#phone").parent().addClass("err_label");$(".chkcode_img").click();this.changeToPanel("bind");break;case 10001:case 5000000:this.phoneTip.show("sys_err");$(".chkcode_img").click();break;default:this.phoneTip.show("sys_err");$(".chkcode_img").click()}},this)})},this);H()},initStep2:function(){var E=$("#retrieve-type .submit-to-next");var G=$("#retrieve-type .retrieve-type");var D=$("#retrieve-type .retrieve-type-value");var F=this.radioTab=$("#retrieve-type .md_way>li").bind("radioTabValueChange",function(J,I){if(I!==false){E.removeClass("disabled");G.val(I.retrieveType);D.val(I.retrieveTypeValue)}else{E.addClass("disabled");G.val("");D.val("")}}).radioTab();var H=this;E.click(function(){if(!E.hasClass("disabled")){H.nextTabPanel();H.nextTabHeader()}})},initStep3:function(){var E=$("#eshop-info");var D=E.find(".submit-to-next").addClass("disabled");E.find(".othway").bind("click",function(){var F=$(this);F.toggleClass("now");if(F.hasClass("now")){$("#eshop-info-inputs-group").data("disable-add","1");E.find(".labelbox").addClass("input_disabled").find("input").attr("disabled","true").val("");E.find(".icon_add_del").addClass("cursor_d");D.removeClass("disabled")}else{$("#eshop-info-inputs-group").data("disable-add","0");E.find(".labelbox").removeClass("input_disabled").find("input").removeAttr("disabled");E.find(".icon_add_del").removeClass("cursor_d");D.addClass("disabled")}});D.bind("click",l.proxy(function(){if(!D.hasClass("disabled")){this.nextTabPanel();this.nextTabHeader()}},this))},initStep4:function(){},initAll:function(){$(this).bind("panelSubmit",l.proxy(function(F,E){this.nextTabPanel();if(E){this.nextTabHeader()}},this));var D=this;$(".un_provide_area").bind("click",l.proxy(function(G){var F=$(G.target);if(F.hasClass("icon_select")){F=F.parent()}if(F.data("disable-click")===1){return false}F.toggleClass("now");var H=F.parents(".halfcon");var E=F.parents(".comfill_con");if(F.hasClass("now")){E.find(".labelbox").addClass("input_disabled").removeClass("err_label").find("input[name!='']").attr("disabled","disabled").val("");E.data("disable-add","1");F.closest(".area_container").find(".icon_add_del").addClass("cursor_d");D.usageTip.hide()}else{E.find(".labelbox").removeClass("input_disabled").find("input[name!='']").removeAttr("disabled");E.data("disable-add","0");F.closest(".area_container").find(".icon_add_del").removeClass("cursor_d")}this.syncUsage(H)},this));$(".panel-btn-back").bind("click",function(){D.prevTabPanel();if($(this).data("first-panel")){D.prevTabHeader()}});$(".halfcon").delegate(".labelbox input","input change",l.proxy(function(E){var F=$(E.target).parents(".halfcon");this.syncUsage(F)},this));$(".halfcon").delegate(".icon_add_del","click",l.proxy(function(E){var F=$(E.target).parents(".halfcon");this.syncUsage(F)},this))},render:function(){this.uiBind();this.initAll();this.initStep2();this.initStep3();this.initStep4();this.toFirstHeader();this.toFirstPanel();var E=$("#resend");E.attr("_text",E.text());this.decoSelect("select[_decorable]");this.decoYearSelect("select.year");$("#YearLocation-dom .areapicker").each(function(G,H){var F=$(H);selectArea(F)});$(".chkcode_img").click();this.passwordItemGroup.render();this.emailItemGroup.render();this.phoneItemGroup.render();this.phoneModelItemGroup.render();this.imeiItemGroup.render();this.eshopInfoItemGroup.render();if(this.sgp){$(".othway").hide()}var D=$("#usage");$("#appeal").append(D);$("#uploadImgForm").appendTo("#nested").show();$("#YearLocation-dom .i_selectoption > dd:first-child").hide()},toFirstHeader:function(){var E=$(".tab_opt > span");var D=0;$(E.removeClass("now")[D]).addClass("now");var F=$(".tabline > i");$(F.removeClass("now")[D]).addClass("now");window.scrollTo(0,0)},syncUsage:function(I){var H=this;var G=I.find('.input_kuang[name!=""]');var F=I.find('.input_kuang[name!=""][value=]:not(":disabled")');var E=I.closest(".bd").find(".btn_commom");var D=true;G.each(function(){var K=$(this);if(K.attr("name")==="eshopPhoneNumber"||K.attr("name")==="bindPhoneUsed"){var J=K.val();if(J!==""&&!H.isPhoneNumber(J)){D=false}}});if(!F.length&&D){E.removeClass("disabled")}else{E.addClass("disabled")}},toFirstPanel:function(){var E=$("#appeal .bd");var D=0;$(E.hide()[D]).show();window.scrollTo(0,0)},nextnextTabHeader:function(){var E=$(".tab_opt > span");var D=E.filter(".now").index("span");$(E.removeClass("now")[D+2]).addClass("now");var F=$(".tabline > i");$(F.removeClass("now")[D+2]).addClass("now");window.scrollTo(0,0)},nextTabHeader:function(){var E=$(".tab_opt > span");var D=E.filter(".now").index("span");$(E.removeClass("now")[D+1]).addClass("now");var F=$(".tabline > i");$(F.removeClass("now")[D+1]).addClass("now");window.scrollTo(0,0)},prevprevTabHeader:function(){var E=$(".tab_opt > span");var D=E.filter(".now").index("span");$(E.removeClass("now")[D-2]).addClass("now");var F=$(".tabline > i");$(F.removeClass("now")[D-2]).addClass("now");window.scrollTo(0,0)},prevTabHeader:function(){var E=$(".tab_opt > span");var D=E.filter(".now").index("span");$(E.removeClass("now")[D-1]).addClass("now");var F=$(".tabline > i");$(F.removeClass("now")[D-1]).addClass("now");window.scrollTo(0,0)},nextnextTabPanel:function(){var E=$("#appeal .bd");var D=E.filter(":visible").index(".bd");$(E.hide()[D+2]).show();window.scrollTo(0,0)},nextTabPanel:function(F){var E=$("#appeal .bd");var D=E.filter(":visible").index(".bd");if(F){$(E.hide()[D+F]).show()}else{$(E.hide()[D+1]).show()}window.scrollTo(0,0)},prevTabPanel:function(F){var E=$("#appeal .bd");var D=E.filter(":visible").index(".bd");if(F){$(E.hide()[D-F]).show()}else{$(E.hide()[D-1]).show()}window.scrollTo(0,0)},changeToPanel:function(E){var D=$("#appeal .bd");var F=D.filter(":visible").attr("id");if(E!==F){D.hide();$("#"+E).show();window.scrollTo(0,0)}},prevprevTabPanel:function(){var E=$("#appeal .bd");var D=E.filter(":visible").index(".bd");$(E.hide()[D-2]).show();window.scrollTo(0,0)},decoSelect:function(D){var E=$(D);E.iSimulateSelect();$(".i_currentselected, i_selectoption, .i_selectoption").css("width","100%");$(".i_selectoption > dd:first-child").hide()},appendSelect:function(D,E){$(E).append(decoSelect(D))},prependSelect:function(D,E){$(E).prepend(decoSelect(D))},decoYearSelect:function(D){$(D).each(function(F,H){var E=H.options;E.length=1;var G=new Date().getFullYear();for(var J=G;J>=2012;J--){var I=$('<option value="'+J+'">'+J+"</option>").appendTo(H)}})},submit:function(){var H="";switch(+$("#reg_by").val()){case -1:case 1:H=$("#reg_via").val();break;case 2:H=$("#reg_via2").val();break;case 0:H=$("#reg_via3").val();break;default:}$("#reg_way").val(H);$('#devices [name="androidPhoneIMEI"], #devices [name="iphoneWIFI"]').each(function(I,J){var K=$.trim(J.value);if(!K){$(J).remove()}});var F=$("#services .checkbox_container.now");var D=$("#services .serviceUsed");F.each(function(I,J){var K=$(J).find(".icon_select").attr("value");D.filter('[value="'+K+'"]').prop("checked",true)});var G=$("#locations .areapicker"),E=$("#locations .frequentlyLoginLocation");G.each(function(K,R){var P=$(R);var L=P.find(".year"),M=P.find(".country"),Q=P.find(".province"),J=P.find(".city");var N=L.val(),I=M.val();if(N&&I){var O=[L.val(),M.val(),Q.val(),J.val()].join("-");$(E[K]).val(O)}});$("#appeal").trigger("submit")}});var i=l.$class({constructor:function(D){this.$parent=$(D.parent||D.$parent);this.selector=D.selector;this.source=D.source;this.$add=$(D.add||D.$add);this.$remove=$(D.remove||D.$remove);this.min="min" in D?D.min:1;this.max="max" in D?D.max:Number.MAX_VALUE},items:function(){return this.$parent.children(this.selector)},size:function(){return this.items().length},uiBind:function(){this.$add.click(l.proxy(function(D){D.preventDefault();this.add()},this));this.$remove.click(l.proxy(function(D){D.preventDefault();this.remove()},this))},add:function(){var D=this.items(),E=D.length;var H=this.$parent.find(".un_provide_area");if(this.$parent.data("disable-add")==="1"){return}if(E<this.max){var G=$(this.source);var F=$(D[E-1]);if(F.length){F.after(G)}else{this.$parent.append(G)}}this.$remove.show();H.hide();if(E+1>=this.max){this.$add.hide()}},remove:function(){var D=this.items(),E=D.length;var F=this.$parent.find(".un_provide_area");if(this.$parent.data("disable-add")==="1"){return}if(E>this.min){$(D[E-1]).remove()}this.$add.show();if(E-1<=this.min){this.$remove.hide();F.show()}},render:function(){this.uiBind();var D=this.size();if(D<=this.min){this.$remove.hide()}else{this.$remove.show()}if(D>=this.max){this.$add.hide()}else{this.$add.show()}}});var q=l.$class({constructor:function(D){D=D||{};this.$idBox=$("#externalId");this.$form=this.$idBox.closest("FORM");this.idTip=new A(".id_tip")},render:function(){this.uiBind()},uiBind:function(){this.$idBox.bind("click focus",l.proxy(function(D){this.idTip.hide();this.$idBox.parent().removeClass("err_label")},this));this.$form.submit(l.proxy(function(E){var F=$.trim(this.$idBox.val());if(!F){this.idTip.show("empty_id");this.$idBox.parent().addClass("err_label");return false}var D=new RegExp(this.$idBox.attr("rule"));if(!D.test(F)){this.idTip.show("wng_fmt");this.$idBox.parent().addClass("err_label");return false}F=F.replace(/^\+86/,"");this.$idBox.val(F)},this))}});return{Security:h,Profile:x,LoginManager:g,BindingA11N:r,Services:a,Utils:c,AppealForm:w,PreappealForm:q}});