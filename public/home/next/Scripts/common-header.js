var shpHeader=shpHeader||{};var isIE=!!window.ActiveXObject;var isIE6=isIE&&!window.XMLHttpRequest;var clickEvnetType=0;shpHeader.searchHead=function(){var a=$("#oversearchKeywords");var b=$("#overheadSearchResults");a.focus(function(){a.css("color","#333");var c=a.val();if(c==shpHeader.ajaxfn.serchDefaultKeywordShow){a.val("")}});a.blur(function(){var c=a.val();if(c==""){a.val(shpHeader.ajaxfn.serchDefaultKeywordShow);a.css("color","#bbb")}else{a.val(c)}});a.click(function(c){c.stopPropagation();var e=new Date().getTime();if(e-shpHeader.ajaxfn.lastGetHistroyTime>300){shpHeader.ajaxfn.lastGetHistroyTime=e;shpHeader.ajaxfn.getHistroy()}if(shpHeader.ajaxfn.isDelAll==1){shpHeader.ajaxfn.sureDelAll()}if(shpHeader.ajaxfn.searchHotKeyWordsIsReady==0){shpHeader.ajaxfn.getSearchHotKeyWords()}b.show()})};shpHeader.search=function(){var e=$("#overheadSearchResults");var f=function(k){var l,h,k=k||0;l=$("#oversearchKeywords");h=$.trim(l.val());if(h=="搜海外购"){h="海外购"}if(h==""||h==shpHeader.ajaxfn.serchDefaultKeywordShow){h=shpHeader.ajaxfn.serchDefaultKeyword}h=a(h);var g="//shppre.s.cnsuning.com/search/"+encodeURIComponent(b(h))+"/0-P1.htm";var m=d("cityId")||"9173";g+="/cityId="+m;window.open(g);return false};function b(g){g=g.replace(/\-/g,"%2d");g=g.replace(/\&/g,"%26");g=g.replace(/\./g,"%2E");g=g.replace(/\+/g,"%2B");return g}function a(l){var k=l;var g="";for(var h=0;h<k.length;h++){if(k.charCodeAt(h)==12288){g+=String.fromCharCode(k.charCodeAt(h)-12256);continue}if(k.charCodeAt(h)>65280&&k.charCodeAt(h)<65375){g+=String.fromCharCode(k.charCodeAt(h)-65248)}else{g+=String.fromCharCode(k.charCodeAt(h))}}return g}$("#oversearchSubmit").on("click",function(){f()});$("#oversearchKeywords").keydown(function(g){if(g.which==13){$("#oversearchSubmit").click();return false}});$("#oversearchAllsearchSubmit").on("click",function(){f(1)});e.mouseenter(function(){$(this).show()});var c=e.find(".history-results");c.delegate(".history-content","hover",function(){if(!$(this).hasClass("title")){$(this).addClass("active").siblings().removeClass("active")}});c.delegate(".del-fn","click",function(h){h.stopPropagation();if($(this).hasClass("del-all")){shpHeader.ajaxfn.histroyDelAll()}else{if($(this).hasClass("del-one")){var g=$.trim($(this).siblings(".name-box").find(".name").html());shpHeader.ajaxfn.histroyDelOne(g,$(this))}}});c.delegate(".cancel-del","click",function(g){g.stopPropagation();shpHeader.ajaxfn.isDelAll=0;c.html(shpHeader.ajaxfn.cacheHtml)});e.find(".close").click(function(){if(shpHeader.ajaxfn.isDelAll==1){shpHeader.ajaxfn.sureDelAll()}e.hide()});$(window).scroll(function(){if(shpHeader.ajaxfn.isDelAll==1){shpHeader.ajaxfn.sureDelAll()}e.hide()});$("body").click(function(){if(shpHeader.ajaxfn.isDelAll==1){shpHeader.ajaxfn.sureDelAll()}e.hide()})};shpHeader.searchDirect=function(){var b=$("#oversearchKeywords");var a=b.attr("value");b.focus(function(){b.css("color","#333");var f=b.val();if(f==a){b.val("")}}).blur(function(){var f=b.val();if(f==""){b.val(a);b.css("color","#bbb")}else{b.val(f)}}).keydown(function(f){if(f.which==13){clickEvnetType=1;$("#oversearchSubmit").click();return false}});$("#oversearchSubmit").on("click",function(){clickEvnetType==0;c()});function c(){if(clickEvnetType==0){var k=$("#oversearchSubmit").get(0);try{sa.click.sendDatasIndex(k)}catch(h){}}else{var k=$("#oversearchKeywords").get(0);try{sa.click.sendDatasIndex(k)}catch(h){}}var f=$("#oversearchKeywords").val();f=(f==a)?"":f;searchKey=encodeURIComponent(encodeURIComponent(e(f)));var g=searchItemUrl+"/search/"+searchKey+"/0-P1.htm";window.open(g)}function e(f){f=f.replace(/\-/g,"%2d");f=f.replace(/\&/g,"%26");f=f.replace(/\./g,"%2E");f=f.replace(/\+/g,"%2B");f=f.replace(/\</g,"&lt;");f=f.replace(/\>/g,"&gt;");return f}};shpHeader.ajaxfn={init:function(){shpHeader.getDomain.setDomain();this.custno=d("custno")||"";this.getHot();this.getHistroy()},custno:"",getHot:function(){$.ajax({url:shpHeader.getDomain.domains.ajaxfn+"ds/hotkeywords/22010--shpHeader.ajaxfn.hotReturn.jsonp",dataType:"jsonp",success:function(){},error:function(){}})},hotReturn:function(l){if(typeof l!=undefined&&l&&l!="undefined"){var k=$(".overhead-search");var g=d("cityId")||"9173";if(typeof l.keywords!=undefined&&l.keywords&&l.keywords!="undefined"){var f="";for(var e=0,a=l.keywords.length;e<a;e++){if(e>4){break}if(typeof l.keywords[e]["keyword"]!=undefined&&l.keywords[e]["keyword"]&&l.keywords[e]["keyword"]!="undefined"&&typeof l.keywords[e]["urlKeyword"]!=undefined&&l.keywords[e]["urlKeyword"]&&l.keywords[e]["urlKeyword"]!="undefined"){var c="";if(typeof l.keywords[e]["highlight"]!=undefined&&l.keywords[e]["highlight"]&&l.keywords[e]["highlight"]!="undefined"&&l.keywords[e]["highlight"]==true){c='style="color:#775dcf;"'}f+='<a href="'+shpHeader.getDomain.domains.search+l.keywords[e]["urlKeyword"]+"/cityId="+g+'&ch=3" target="_blank" '+c+">"+l.keywords[e]["keyword"]+"</a>"}}k.find(".overhead-search-hotwrods-box").html(f)}if(typeof l.defaultKeyword!=undefined&&l.defaultKeyword&&l.defaultKeyword!="undefined"&&typeof l.defaultKeywordShow!=undefined&&l.defaultKeywordShow&&l.defaultKeywordShow!="undefined"){var h=$("#searchKeywordsHidden").val();var b="";if(typeof h!="undefined"&&h!=""){this.isAlreadyResearch=h;b=h}else{b=l.defaultKeywordShow}$("#oversearchKeywords").val(b);this.serchDefaultKeyword=l.defaultKeyword;this.serchDefaultKeywordShow=l.defaultKeywordShow}}shpHeader.searchHead()},isAlreadyResearch:"",serchDefaultKeyword:"",serchDefaultKeywordShow:"",lastGetHistroyTime:0,getHistroy:function(){var b=this;if(b.isDelAll==1){return}if(b.custno==""){var a="";a+='<li class="title gray"><span class="name">最近搜索</span></li><li class="history-no-data"></li>';$("#overheadSearchResults .history-results").html(a);return}$.ajax({url:shpHeader.getDomain.domains.ajaxfn+"ds/his/ext/"+b.custno+"--4-shpHeader.ajaxfn.histroyReturn.jsonp",dataType:"jsonp",success:function(c){},error:function(){}})},histroyReturn:function(c){var e="";var f=d("cityId")||"9173";if(typeof c!=undefined&&c&&c!="undefined"&&typeof c.rs!=undefined&&c.rs&&c.rs!="undefined"){e+='<li class="title"><span class="name">最近搜过</span><a class="r del-fn del-all" href="javascript:void(0);"><span class="del-icon"></span>清空</a></li>';var b=c.rs.length;if(b>0){for(var a=0;a<b;a++){if(a>11){break}if(typeof c.rs[a]["keyname"]!=undefined&&c.rs[a]["keyname"]&&c.rs[a]["keyname"]!="undefined"){e+='<li class="history-content"><a class="name-box" href="'+shpHeader.getDomain.domains.search+c.rs[a]["keyname"]+"/cityId="+f+'&ch=3"><span class="name">'+c.rs[a]["keyname"]+'</span></a><span class="del-icon del-fn del-one"></span></li>'}}}else{e='<li class="title gray"><span class="name">最近搜索</span></li><li class="history-no-data"></li>'}}else{e+='<li class="title gray"><span class="name">最近搜索</span></li><li class="history-no-data"></li>'}$("#overheadSearchResults .history-results").html(e)},histroyDelOne:function(a,b){var c=this;var a=a||"";c.histroyDelOneTarget=b;if(c.custno==""||a==""){return}$.ajax({url:shpHeader.getDomain.domains.ajaxfn+"ds/his/ext/del/"+c.custno+"-"+a+"-4-shpHeader.ajaxfn.histroyDelReturn.jsonp",dataType:"jsonp",success:function(e){},error:function(){}})},histroyDelOneTarget:"",histroyDelReturn:function(a){if(typeof a!=undefined&&a&&a!="undefined"&&typeof a.rs!=undefined&&a.rs&&a.rs!="undefined"&&a.rs==="T"){this.histroyDelOneTarget.parent(".history-content").remove()}},histroyDelAll:function(){var c=this;c.isDelAll=1;var b=$("#overheadSearchResults .history-results");c.cacheHtml=b.html();var a='<li class="title gray"><span class="name">你的历史记录已被清空</span><a class="cancel-del">撤销</a></li><li class="history-no-data"></li>';b.html(a)},histroyDelAllReturn:function(a){var b=this;b.isDelAll=0},cacheHtml:"",isDelAll:0,sureDelAll:function(){var b=this;var a="";a+='<li class="title gray"><span class="name">最近搜索</span></li><li class="history-no-data"></li>';$("#overheadSearchResults .history-results").html(a);$.ajax({url:shpHeader.getDomain.domains.ajaxfn+"ds/his/ext/clean/"+b.custno+"-shpHeader.ajaxfn.histroyDelAllReturn.jsonp",dataType:"jsonp",success:function(c){},error:function(){b.isDelAll=0}})},searchHotKeyWordsIsReady:0,getSearchHotKeyWords:function(){this.searchHotKeyWordsIsReady=1;$.ajax({url:shpHeader.getDomain.domains.ajaxfn+"ds/searchHotkeywords/22010-shpHeader.ajaxfn.searchHotKeyWordsReturn.jsonp",dataType:"jsonp",success:function(a){},error:function(){}})},searchHotKeyWordsReturn:function(b){var e="";var f=d("cityId")||"9173";e+='<li class="title"><span class="name">正在热搜中</span><a href="javascript:void(0);" class="close">X</a></li>';if(typeof b!=undefined&&b&&b!="undefined"){for(var a=0,c=b.length;a<c;a++){e+='<li><a class="rec-results-content" href="'+shpHeader.getDomain.domains.search+b[a]["urlKeyword"]+"/cityId="+f+'&ch=3" target="_blank">'+b[a]["keyword"]+"</a></li>"}}$("#overheadSearchResults .rec-results").html(e)}};shpHeader.getDomain={getEnv:function(){var c=/^(\w*)(pre)(\w*)(.cnsuning.com)$/,b=/^(\w*)([^2]sit)(\w*)(.cnsuning.com)$/,e=/^(\w*)(2sit)(\w*)(.cnsuning.com)$/,a=window.location.hostname;if(c.test(a)){return"pre"}else{if(b.test(a)){return"sit"}else{if(e.test(a)){return"sit2"}}}return"prd"},setDomain:function(){var a=this;switch(a.getEnv()){case"prd":a.domains={ajaxfn:"http://ds.suning.cn/",search:"http://search.suning.com/"};break;case"pre":a.domains={ajaxfn:"http://dspre.cnsuning.com/",search:"http://searchpre.cnsuning.com/"};break;case"sit":a.domains={ajaxfn:"http://dssit.cnsuning.com/",search:"http://searchsit.cnsuning.com/"};break;case"sit2":a.domains={ajaxfn:"http://dssit.cnsuning.com/",search:"http://searchsit.cnsuning.com/"};break}}};var myc2cDropboxDown;function myc2cDropbox(){$(".dropdown").on("mouseenter",function(){var a=$(this),b=a.find(".ng-nav-box");a.addClass("hover");if(!isIE6){b.stop(true,true).slideDown()}else{b.show()}}).on("mouseleave",function(){var a=$(this),b=a.find(".ng-nav-box");myc2cDropboxDown=setTimeout(function(){a.removeClass("hover");if(!isIE6){b.slideUp()}else{b.hide()}},300)})}function navCategoryHover(){var f=$(".nmc-sort-list li");var b=$(".nmc-sort-detail .nmc-sort-detail-sub");var e=176;var a;f.on("mouseenter",function(){var l=$(this),g=l.index(),k=$(".nmc-sort-detail .nmc-sort-detail-sub").eq(g),h=$(".nmc-sort-detail .nmc-sort-detail-sub.cur");clearTimeout(a);l.addClass("cur").siblings(".cur").removeClass("cur");if(h.length!=0){h.removeClass("cur");k.addClass("cur").css("width",e)}else{k.stop(true,true).css("width",0).addClass("cur").animate({width:e},200)}}).on("mouseleave",function(){var l=$(this),g=l.index(),k=$(".nmc-sort-detail .nmc-sort-detail-sub").eq(g),h=$(".nmc-sort-detail .nmc-sort-detail-sub.cur");clearTimeout(a);l.removeClass("cur");a=setTimeout(function(){k.removeClass("cur")},100)});b.on("mouseenter",function(){var h=$(this),g=h.index(),k=$(".nmc-sort-list li").eq(g);clearTimeout(a);k.addClass("cur");h.addClass("cur")}).on("mouseleave",function(){var g=$(this);clearTimeout(a);a=setTimeout(function(){f.removeClass("cur");g.removeClass("cur")},100)});var c=$(".banner-wrap").length?true:false;if(!c){$(".nav-main-category").on("mouseenter",function(){var g=$(this),h=g.find(".nmc-sort-list");g.addClass("hover");if(!isIE6){h.stop(true,true).slideDown(200)}else{h.show()}}).on("mouseleave",function(){var g=$(this),h=g.find(".nmc-sort-list");g.removeClass("hover");if(!isIE6){h.stop(true,true).slideUp(200)}else{h.hide()}})}}function getallcategorylist(){$.ajax({url:shpPcServerUrl+"/getallcategorylist.do",type:"post",data:{},dataType:"json",async:false,success:function(b){if(null!=b.categoryList){temp="";temp1="";var a=b.categoryList;for(i=0;i<a.length;i++){temp+="<li>";temp+='<em class="nav-icon nav-icon-'+(i+1)+'"></em>';childList=a[i].child;for(j=0;j<childList.length;j++){temp+='<a name="PcYoupin_none_list0'+(i+1)+"0"+(j+1)+'" href="'+searchItemUrl+"/search/0-"+a[i].categoryCode+"-"+childList[j].categoryCode+'-P1.htm" target="_blank">'+childList[j].categoryName+"</a>";if(i==3||i==7){if(j==2){break}}else{if(j==3){break}}}temp+="</li>"}for(i=0;i<a.length;i++){temp1+='<div class="nmc-sort-detail-sub">';temp1+='<div class="nav-sub-cont clearfix">';temp1+='<div class="nav-sub-item">';temp1+="<p>";childList=a[i].child;for(j=0;j<childList.length;j++){temp1+='<a name="PcYoupin_none_list_detail0'+(i+1)+"0"+(j+1)+'" href="'+searchItemUrl+"/search/0-"+a[i].categoryCode+"-"+childList[j].categoryCode+'-P1.htm" target="_blank">'+childList[j].categoryName+"</a>"}temp1+="</p></div></div></div>"}$(".nmc-sort-list").append(temp);$(".nmc-sort-detail").append(temp1)}}})}$(function(){myc2cDropbox();getallcategorylist();navCategoryHover();shpHeader.searchDirect()});